<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo|王祖亮</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="android 安卓">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo|王祖亮">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Hexo|王祖亮">
<meta property="og:description" content="android 安卓">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo|王祖亮">
<meta name="twitter:description" content="android 安卓">
  
    <link rel="alternative" href="/atom.xml" title="Hexo|王祖亮" type="application/atom+xml">
  
  
    <link rel="icon" href="/32.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/touxiang.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">王祖亮</a></h1>
		</hgroup>

		
		<p class="header-subtitle">一只码畜</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/ZuLiangWang" title="github">github</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">Hust Cser / Android Coder      zuliangwang@hustunique.com  329851721@qq.com</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">王祖亮</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/touxiang.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">王祖亮</h1>
			</hgroup>
			
			<p class="header-subtitle">一只码畜</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/ZuLiangWang" title="github">github</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-share" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/21/share/" class="article-date">
  	<time datetime="2016-10-20T16:07:18.000Z" itemprop="datePublished">2016-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/21/share/">Gradle Share</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.gradle&#x6982;&#x5FF5;<br>groovy&#x57FA;&#x672C;&#x8BED;&#x6CD5;<br>gradle&#x3001;project&#x3001;task<br>gradlew  gradle wrapper<br>&#x63D2;&#x4EF6; plugin &#x6982;&#x5FF5;&#x3001;&#x4F5C;&#x7528;</p>
<p>2.gradle&#x547D;&#x4EE4;<br>clean<br>bulid<br>tasks&#xFF08;Android Studio&#x67E5;&#x770B;&#xFF09;</p>
<p><a href="https://github.com/tfnico/vim-gradle" target="_blank" rel="external">https://github.com/tfnico/vim-gradle</a><br>&#x8BA9;vim&#x80FD;&#x8BC6;&#x522B;gradle&#x8BED;&#x6CD5;</p>
<p>feature<br>1.Executing multiple tasks  &#x6267;&#x884C;&#x591A;&#x4E2A;task&#xFF0C;&#x6BCF;&#x4E2A;&#x53EA;&#x6267;&#x884C;&#x4E00;&#x6B21;<br>   gradle  task1 task2<br>2.Excluding tasks           &#x53EF;&#x4EE5;&#x6392;&#x9664;&#x67D0;&#x4E2A;task&#x4E0D;&#x6267;&#x884C;<br>    gradle task2 -x task1<br>    task2 dependent task1<br>3.Continuing the build when a failure occurs            &#x5FFD;&#x7565;&#x9519;&#x8BEF;&#x7EE7;&#x7EED;&#x6267;&#x884C;<br>   &#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x5176;&#x5B83;&#x95EE;&#x9898;<br>4.Task name abbreviation<br>   gradle&#x672C;&#x8EAB;&#x53EF;&#x4EE5;&#x8BC6;&#x522B;&#x7F29;&#x5199;<br>   &#x5982;&#x6267;&#x884C;task wangzuliang<br>   gradle wzl<br>5.Selecting which build to execute<br>  &#x53EF;&#x4EE5;&#x628A;&#x6587;&#x4EF6;&#x5F53;&#x6210;&#x53C2;&#x6570;&#x4F20;&#x9012;<br>  gradle -b zuliangwang/file1 task1<br>6.Forcing tasks to execute<br>  &#x81EA;&#x5E26;&#x589E;&#x91CF;&#x7F16;&#x8BD1; gradle sdk&#x91CC;&#x63D0;&#x4F9B;&#x7684;task&#x5927;&#x90E8;&#x5206;&#x90FD;&#x80FD;&#x589E;&#x91CF;&#x7F16;&#x8BD1;<br>  &#x6BCF;&#x6B21; gradle task1 &#x53EA;&#x7F16;&#x8BD1;&#x589E;&#x91CF;&#x90E8;&#x5206;<br>7.gradle&#x81EA;&#x5E26;&#x4E00;&#x4E9B;&#x7F16;&#x8BD1;&#x65F6;&#x5DE5;&#x5177;&#x5E2E;&#x52A9;&#x5206;&#x6790;<br>  &#x8BE6;&#x7EC6;<br>  <a href="https://docs.gradle.org/current/userguide/project_reports_plugin.html" target="_blank" rel="external">https://docs.gradle.org/current/userguide/project_reports_plugin.html</a></p>
<ol>
<li>Dry Run<br>&#x7C7B;&#x4F3C;&#x6253;Log&#x89C2;&#x5BDF;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x4E0D;&#x6267;&#x884C;task&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4EC5;&#x663E;&#x793A;&#x6267;&#x884C;&#x987A;&#x5E8F;<br>gradle -m task1</li>
</ol>
<p>3.build.gradle setting.gralde<br>&#x5E38;&#x89C1;&#x5C5E;&#x6027;&#x5206;&#x6790;<br>&#x770B;&#x61C2;Android Projecct&#x4E2D;&#x7684;build.gradle<br>Porject:settings.gradle&#x548C;build.gradle<br>task&#x7684;&#x6267;&#x884C;&#x987A;&#x5E8F;</p>
<p>4.<br>gradle&#x811A;&#x672C;&#x4E66;&#x5199;<br>task simpleTask &lt;&lt; {<br>    &#x2026;<br>}</p>
<p>gradle blog<br><a href="http://www.infoq.com/cn/articles/android-in-depth-gradle?utm_source=infoq&amp;utm_medium=related_content_link&amp;utm_campaign=relatedContent_articles_clk" target="_blank" rel="external">http://www.infoq.com/cn/articles/android-in-depth-gradle?utm_source=infoq&amp;utm_medium=related_content_link&amp;utm_campaign=relatedContent_articles_clk</a></p>
<p><a href="https://segmentfault.com/a/1190000004234712?_ea=538654" target="_blank" rel="external">https://segmentfault.com/a/1190000004234712?_ea=538654</a></p>
<p>gradle&#x5B98;&#x65B9;&#x6587;&#x6863;<br><a href="https://docs.gradle.org/current/userguide/overview.html" target="_blank" rel="external">https://docs.gradle.org/current/userguide/overview.html</a><br>&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;android<br>web js   java app<br>&#x6838;&#x5FC3; build your project</p>
<p>Groovy<br>Gradle&#x2019;s build scripts are written in Groovy, not XML. But unlike other approaches this is not for simply exposing the raw scripting power of a dynamic language. That would just lead to a very difficult to maintain build. The whole design of Gradle is oriented towards being used as a language, not as a rigid framework. And Groovy is our glue that allows you to tell your individual story with the abstractions Gradle (or you) provide. Gradle provides some standard stories but they are not privileged in any form. This is for us a major distinguishing feature compared to other declarative build systems. Our Groovy support is not just sugar coating. The whole Gradle API is fully Groovy-ized. Adding Groovy results in an enjoyable and productive experience.</p>
<p>groovy API&#x624B;&#x518C;<br><a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/index-all.html" target="_blank" rel="external">http://docs.groovy-lang.org/latest/html/groovy-jdk/index-all.html</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Linux常用命令总结和复习" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/21/Linux常用命令总结和复习/" class="article-date">
  	<time datetime="2016-10-20T16:04:56.000Z" itemprop="datePublished">2016-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/21/Linux常用命令总结和复习/">Linux常用命令总结和复习</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#x53EA;&#x8BB0;&#x5F55;&#x5404;&#x4E2A;&#x547D;&#x4EE4;&#x5927;&#x81F4;&#x4F5C;&#x7528;&#xFF0C;&#x5177;&#x4F53;&#x53C2;&#x6570;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x65F6;&#x7EC6;&#x67E5;&#x3002;</p>
<p>&#x6587;&#x4EF6;&#x64CD;&#x4F5C;:</p>
<ol>
<li>cd destination &#x8FDB;&#x5165;&#x76EE;&#x5F55; &#x53EF;&#x4F7F;&#x7528;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x548C;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x3002;</li>
<li>ls &#x663E;&#x793A;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x6587;&#x4EF6;&#x548C;&#x76EE;&#x5F55;&#x3002;</li>
<li>touch fileName &#x5728;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7A7A;&#x6587;&#x4EF6;</li>
<li>cp source destination &#x590D;&#x5236;&#x6587;&#x4EF6;</li>
<li>cp -l src des &#x521B;&#x5EFA;&#x6E90;&#x6587;&#x4EF6;&#x7684;&#x4E00;&#x4E2A;&#x786C;&#x94FE;&#x63A5;&#xFF0C;&#x7B49;&#x540C;&#x4E8E;Windows&#x4E0B;&#x7684;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#x3002;<br>cp -s src des &#x521B;&#x5EFA;&#x6E90;&#x6587;&#x4EF6;&#x7684;&#x4E00;&#x4E2A;&#x8F6F;&#x94FE;&#x63A5;&#x3002;<br>&#x786C;&#x94FE;&#x63A5;&#x548C;&#x8F6F;&#x94FE;&#x63A5;&#x5728;&#x6E90;&#x6587;&#x4EF6;&#x79FB;&#x52A8;&#x6216;&#x66F4;&#x6539;&#x6587;&#x4EF6;&#x540D;&#x65F6;&#x6709;&#x5DEE;&#x5F02;&#x3002;</li>
<li>mv src des &#x79FB;&#x52A8;&#x6E90;&#x6587;&#x4EF6;&#x6587;&#x4EF6;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;rename&#x6E90;&#x6587;&#x4EF6;&#x3002;</li>
<li>rm fileName &#x5220;&#x9664;&#x6E90;&#x6587;&#x4EF6;&#x3002;</li>
<li>mkdir folderName &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x3002;</li>
<li>rmdir folderName &#x5220;&#x9664;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x3002;</li>
<li>stat fileName &#x663E;&#x793A;&#x6587;&#x4EF6;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x3002;</li>
<li>file fileName &#x663E;&#x793A;&#x6587;&#x4EF6;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x6587;&#x4EF6;&#x5206;&#x4E3A;&#x4E09;&#x7C7B;&#xFF1A;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x3001;&#x6587;&#x672C;&#x6587;&#x4EF6;&#x3001;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x3002;</li>
<li>cat fileName &#x663E;&#x793A;&#x6587;&#x672C;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x3002;</li>
<li>more fileName cat&#x8FDB;&#x5316;&#x7248;&#xFF0C;&#x53EF;&#x4EE5;&#x540C;&#x7F16;&#x8F91;&#x5668;&#x4E00;&#x6837;&#x4E0A;&#x4E0B;&#x79FB;&#x52A8;&#x67E5;&#x770B;&#x6587;&#x672C;&#x5185;&#x5BB9;&#x3002;</li>
<li>less fileName more&#x8FDB;&#x5316;&#x7248;&#xFF0C;&#x589E;&#x6DFB;&#x4E86;&#x4E00;&#x4E9B;&#x9AD8;&#x7EA7;&#x529F;&#x80FD;&#x3002;&#x547D;&#x4EE4;&#x540D;&#x7531;&#x6765;&#xFF1A;less is more&#x3002;</li>
<li>tail fileName &#x67E5;&#x770B;&#x6587;&#x4EF6;&#x672B;&#x5C3E;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#xFF0C;&#x9ED8;&#x8BA4;&#x663E;&#x793A;&#x672B;&#x5C3E;10&#x884C;&#x3002;</li>
<li>head fileName &#x67E5;&#x770B;&#x6587;&#x4EF6;&#x5934;&#x90E8;&#x5185;&#x5BB9;&#xFF0C;&#x9ED8;&#x8BA4;&#x663E;&#x793A;&#x5934;10&#x884C;&#x3002;</li>
</ol>
<p>&#x8FDB;&#x7A0B;&#x64CD;&#x4F5C;:</p>
<ol>
<li>ps &#x663E;&#x793A;&#x5F53;&#x524D;&#x7CFB;&#x7EDF;&#x4E0B;&#x7684;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x53CA;&#x5176;&#x72B6;&#x6001;&#x3002;</li>
<li>top &#x5B9E;&#x65F6;&#x663E;&#x793A;&#x7CFB;&#x7EDF;&#x4E0B;&#x7684;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x53CA;&#x5176;&#x72B6;&#x6001;&#xFF0C;&#x76F8;&#x6BD4;ps&#xFF0C;&#x5B83;&#x662F;&#x52A8;&#x6001;&#x7684;&#x3002;</li>
<li>kill pid &#x6740;&#x6B7B;&#x6307;&#x5B9A;pid&#x7684;&#x8FDB;&#x7A0B;&#x3002;</li>
<li>killall http* &#x6740;&#x6B7B;&#x5168;&#x90E8;&#x4EE5;http&#x5F00;&#x5934;&#x7684;&#x8FDB;&#x7A0B;&#x3002;</li>
</ol>
<p>&#x78C1;&#x76D8;&#x64CD;&#x4F5C;:</p>
<ol>
<li>mount device directory &#x628A;&#x6307;&#x5B9A;&#x8BBE;&#x5907;&#x6302;&#x8F7D;&#x5230;&#x6307;&#x5B9A;&#x76EE;&#x5F55;&#x3002;</li>
<li>unmount [directory | device] &#x5C06;&#x6307;&#x5B9A;&#x76EE;&#x5F55;&#x6216;&#x6307;&#x5B9A;&#x8BBE;&#x5907;&#x5378;&#x8F7D;&#x3002;</li>
<li>df &#x663E;&#x793A;&#x6240;&#x6709;&#x5DF2;&#x6302;&#x8F7D;&#x78C1;&#x76D8;&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x53EF;&#x67E5;&#x770B;&#x5269;&#x4F59;&#x5BB9;&#x91CF;&#x3002;</li>
<li>du &#x663E;&#x793A;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x4E0B;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x3001;&#x76EE;&#x5F55;&#x7684;&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x3002;</li>
</ol>
<p>&#x6570;&#x636E;&#x5904;&#x7406;&#x64CD;&#x4F5C;:</p>
<ol>
<li>sort fileName &#x5BF9;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x9700;&#x8981;&#x7ED3;&#x5408;&#x53C2;&#x6570;&#x8BBE;&#x5B9A;&#x6392;&#x5E8F;&#x7684;&#x5177;&#x4F53;&#x65B9;&#x6CD5;&#x3002;</li>
<li>grep [option] pattern [file] &#x5728;&#x5927;&#x6587;&#x4EF6;&#x4E2D;&#x67E5;&#x8BE2;&#x641C;&#x7D22;&#x7B26;&#x5408;&#x6307;&#x5B9A;&#x89C4;&#x5219;&#x7684;&#x5185;&#x5BB9;&#x3002;</li>
<li>egrep grep&#x7684;&#x6269;&#x5C55;&#x7248;&#x672C;&#x3002;</li>
</ol>
<p>&#x538B;&#x7F29;&#x6570;&#x636E;:</p>
<ol>
<li>bzip2 &#x6587;&#x4EF6;&#x6269;&#x5C55;&#x540D;.bz2</li>
<li>gzip &#x6587;&#x4EF6;&#x6269;&#x5C55;&#x540D;.gz</li>
<li>zip &#x6587;&#x4EF6;&#x6269;&#x5C55;&#x540D;.zip</li>
<li>compress &#x6587;&#x4EF6;&#x6269;&#x5C55;&#x540D;.Z</li>
<li>tar function [options] obj1 obj2 &#x2026; Linux&#x548C;Unix&#x4E0B;&#x6700;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x7684;&#x5F52;&#x6863;&#x5DE5;&#x5177;&#x3002;</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-编译原理实验" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/20/编译原理实验/" class="article-date">
  	<time datetime="2016-10-20T14:44:51.000Z" itemprop="datePublished">2016-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/20/编译原理实验/">编译原理实验</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#x8BED;&#x6CD5;&#x5206;&#x6790;&amp;&#x8BCD;&#x6CD5;&#x5206;&#x6790;</p>
<p>Task 1<br>&#x8BC6;&#x522B;&#x8BCD;&#x6CD5;&#x9519;&#x8BEF;&#x5E76;&#x8F93;&#x51FA;&#x9519;&#x8BEF;&#x4FE1;&#x606F;<br>&#x8981;&#x6C42;:<br>&#x8BC6;&#x522B;&#x516B;&#x8FDB;&#x5236;&amp;&#x5341;&#x516D;&#x8FDB;&#x5236; &#x4E0D;&#x89C4;&#x8303;&#x62A5;&#x9519;<br>&#x8BC6;&#x522B;&#x6307;&#x6570;&#x5F62;&#x5F0F;&#x6D6E;&#x70B9;&#x6570; &#x4E0D;&#x89C4;&#x8303;&#x62A5;&#x9519;<br>&#x8BC6;&#x522B; &#x201C;//&#x201C; &#x201C;/<em> </em>/&#x201C;&#x6CE8;&#x91CA; &#x5E76;&#x8FC7;&#x6EE4;</p>
<p>Task2<br>&#x8BC6;&#x522B;&#x8BED;&#x6CD5;&#x9519;&#x8BEF;&#x5E76;&#x8F93;&#x51FA;&#x9519;&#x8BEF;&#x4FE1;&#x606F;</p>
<p>flex&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#xFF1A;<br>(1)flex src.l  &#x5BF9;&#x7ED9;&#x5B9A;&#x7684;flex&#x6587;&#x4EF6;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;c&#x6587;&#x4EF6;<br>&#x6CE8;&#xFF1A;flex&#x5BF9;&#x6587;&#x4EF6;&#x7684;space&#x975E;&#x5E38;&#x654F;&#x611F;&#xFF0C;&#x4E0D;&#x8981;&#x968F;&#x4FBF;&#x5728;&#x4EE3;&#x7801;&#x91CC;&#x52A0;&#x7A7A;&#x683C;&#xFF0C;&#x5426;&#x5219;&#x975E;&#x5E38;&#x53EF;&#x80FD;&#x4E0D;&#x80FD;&#x6B63;&#x5E38;&#x8F93;&#x51FA;&#x3002;<br>(2)gcc lex.yy.c  -ll -o main &#x7F16;&#x8BD1;c&#x6587;&#x4EF6;&#x751F;&#x6210;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;mac&#x4E0B;&#x4F7F;&#x7528;-ll<br>&#x6CE8;&#xFF1A;&#x56E0;&#x4E3A;OSX&#x4E0B;&#x7684;gcc&#x5B9E;&#x9645;&#x4E0A;&#x662F;clang&#xFF0C;&#x6240;&#x4EE5;&#x547D;&#x4EE4;&#x548C;linux&#x4E0B;&#x6709;&#x51FA;&#x5165;&#x3002;<br>&#x5728;mac&#x4E0B;man gcc&#x4F1A;&#x63D0;&#x793A;&#x627E;&#x4E0D;&#x5230;gcc&#xFF0C;&#x56E0;&#x4E3A;&#x5B9E;&#x9645;&#x8FD9;&#x4E2A;gcc&#x662F;clang<br>(3)./main srcFile &#x628A;&#x6E90;&#x6587;&#x4EF6;&#x4F20;&#x9012;&#x7ED9;&#x8BED;&#x6CD5;&#x5206;&#x6790;&#x751F;&#x6210;&#x5668;</p>
<p>bison&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#xFF1A;<br>(1)flex lexical.l  &#x8BED;&#x6CD5;&#x5206;&#x6790;&#x4F9D;&#x8D56;&#x4E8E;&#x8BCD;&#x6CD5;&#x5206;&#x6790;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x56E0;&#x6B64;&#x9996;&#x5148;&#x8981;&#x5F97;&#x5230;&#x8BCD;&#x6CD5;&#x5206;&#x6790;&#x5668;&#x3002;<br>(2)bison -d syntax.y &#x751F;&#x6210;&#x8BED;&#x6CD5;&#x5206;&#x6790;&#x6587;&#x4EF6;&#xFF0C;-d&#x53C2;&#x6570;&#x662F;&#x4EE4;&#x5176;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;.c&#x6587;&#x4EF6;&#x548C;.h&#x6587;&#x4EF6;&#x3002;<br>&#x6CE8;&#xFF1A;&#x5728;bison&#x6E90;&#x6587;&#x4EF6;syntax.y&#x4E2D;&#x8981;&#x5728;&#x5F15;&#x7528;&#x8BCD;&#x6CD5;&#x5206;&#x6790;&#x5668;&#x6587;&#x4EF6;&#xFF0C;#include &#x201C;lex.yy.c&#x201D;<br>(3)&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x5728;bison&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x8BED;&#x6CD5;&#x7B26;&#x53F7;&#xFF0C;&#x5728;flex&#x751F;&#x6210;&#x7684;&#x8BCD;&#x6CD5;&#x5206;&#x6790;&#x5668;&#x6587;&#x4EF6;&#x4E2D;&#x4E5F;&#x9700;&#x8981;&#x5F15;&#x7528;bison&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#xFF0C;#include &#x201C;syntax.tab.h&#x201D;<br>(4)&#x5B8C;&#x6210;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x7F16;&#x8BD1;&#x94FE;&#x63A5;&#x8BCD;&#x6CD5;&#x5206;&#x6790;&#x5668;&#x6587;&#x4EF6;&#x548C;&#x8BED;&#x6CD5;&#x5206;&#x6790;&#x6587;&#x4EF6;&#xFF0C;&#x8F93;&#x5165;gcc -ll syntax.tab.c lex.yy.c -o scanner&#x5F97;&#x5230;&#x8BED;&#x6CD5;&#x5206;&#x6790;&#x5668;&#x3002;<br>(5)./scanner &#x6839;&#x636E;&#x4EE3;&#x7801;&#x8F93;&#x5165;&#x76F8;&#x5E94;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<p>&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x590D;&#x4E60;&#xFF1A;<br>(1)&#x201D;.&#x201D;&#x8868;&#x793A;&#x901A;&#x914D;&#x7B26;&#xFF0C;&#x5339;&#x914D;&#x9664;&#x4E86;&#x201C;\n&#x201D;&#x4EE5;&#x5916;&#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;<br>(2)&#x201D;[]&#x201D;&#x8868;&#x793A;&#x5B57;&#x7B26;&#x96C6;&#xFF0C;&#x5373;&#x62EC;&#x53F7;&#x5185;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x5339;&#x914D;&#x5230;&#x5219;&#x5C31;&#x7B97;&#x5339;&#x914D;&#x5230;&#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x96C6;&#x3002;&#x7F29;&#x5199;&#x8868;&#x793A;&#x6CD5;[0-9a-zA-Z]&#x3002;&#x201D;^&#x201D;&#x7528;&#x5728;&#x65B9;&#x62EC;&#x53F7;&#x5185;&#x8868;&#x793A;&#x8865;&#x96C6;&#x3002;<br>(3)&#x201D;^&#x201D;&#x7528;&#x5728;&#x65B9;&#x62EC;&#x53F7;&#x5916;&#x4F1A;&#x5339;&#x914D;&#x4E00;&#x884C;&#x7684;&#x5F00;&#x5934;&#x3002;&#x7B26;&#x53F7;&#x201D;$&#x201D;&#x7528;&#x4E8E;&#x5339;&#x914D;&#x4E00;&#x884C;&#x7684;&#x7ED3;&#x5C3E;&#x3002;&#x201C;&lt;<eof>&gt;&#x201D;&#x5339;&#x914D;&#x6587;&#x4EF6;&#x7684;&#x7ED3;&#x5C3E;&#x3002;<br>(4)&#x7B26;&#x53F7;&#x201D;{}&#x201D;&#x591A;&#x91CD;&#x542B;&#x4E49;&#x3002;A{5}&#x8868;&#x793A;AAAAA&#x3002;A{1&#xFF0C;3}&#x8868;&#x793A;A&#x3001;AA&#x6216;&#x8005;AAA&#xFF0C;&#x5373;1&#x5230;3&#x4E2A;A&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5B9A;&#x4E49;&#x7684;&#x540D;&#x5B57;&#x8981;&#x5728;&#x82B1;&#x62EC;&#x53F7;&#x5185;&#xFF0C;&#x5982;{letter}&#x3002;<br>(5)&#x201D;*&#x201C;&#x8868;&#x793A;&#x95ED;&#x5305;&#x64CD;&#x4F5C;&#xFF0C;&#x5339;&#x914D;&#x96F6;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5982;X*&#x8868;&#x793A;&#x96F6;&#x4E2A;&#x6216;&#x591A;&#x4E2A;X&#x3002;<br>(6)&#x201C;+&#x201D;&#x8868;&#x793A;&#x6B63;&#x95ED;&#x5305;&#x64CD;&#x4F5C;&#xFF0C;&#x5339;&#x914D;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x7528;&#x6CD5;&#x540C;&#x4E0A;&#x3002;<br>(7)&#x201C;?&#x201D;&#x8868;&#x793A;&#x96F6;&#x4E2A;&#x6216;&#x8005;&#x4E00;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5373;&#x6709;&#x6216;&#x8005;&#x65E0;&#x3002;<br>&#x6CE8;&#xFF1A;&#x201D;?&#x201D;&#x3001;&#x201D;*&#x201D;&#x3001;&#x201D;+&#x201D;&#x90FD;&#x4EC5;&#x4EC5;&#x53EA;&#x5BF9;&#x5DE6;&#x8FB9;&#x4E34;&#x8FD1;&#x7684;&#x90A3;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#x8D77;&#x6548;&#x3002;&#x5982;abc?&#x8868;&#x793A;ab&#x548C;&#x96F6;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;c<br>(8)&#x201D;|&#x201D;&#x8868;&#x793A;&#x9009;&#x62E9;&#x64CD;&#x4F5C;,&#x5982;a|b|c&#x8868;&#x793A;a&#x6216;&#x8005;b&#x6216;&#x8005;c&#x3002;<br>(9)&#x201D;\&#x201D;&#x8868;&#x793A;&#x8F6C;&#x4E49;&#x5B57;&#x7B26;,&#x4E0E;&#x548C;C&#x8BED;&#x8A00;&#x7C7B;&#x4F3C;&#x3002;<br>(10)&#x201C;&#x201D;&#x201D;&#x8868;&#x793A;&#x5FFD;&#x7565;&#x8F6C;&#x4E49;&#xFF0C;&#x5982;&#x201C;\n&#x201D;&#x4EE3;&#x8868;&#x5B57;&#x7B26;&#x4E32;&#x201D;\n&#x201D;&#x800C;&#x4E0D;&#x662F;&#x6362;&#x884C;&#x7B26;<br>(11)&#x201D;/&#x201C;&#x8868;&#x793A;&#x67E5;&#x770B;&#x8F93;&#x5165;&#x5B57;&#x7B26;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x5982;0/1&#x5339;&#x914D;01&#x4E32;&#x4E2D;&#x7684;0&#x800C;&#x4E0D;&#x5339;&#x914D;02&#x4E2D;&#x7684;0&#x3002;<br>(12)&#x5176;&#x4F59;&#x5269;&#x4E0B;&#x7684;&#x6240;&#x6709;&#x5B57;&#x7B26;&#x90FD;&#x8868;&#x793A;&#x5176;&#x672C;&#x8EAB;&#x3002;</eof></p>
<p><img src="https://github.com/ZuLiangWang/ZuLiangWang.github.io/blob/master/img/zz.png?raw=true" alt="&#x6B63;&#x5219;&#x4F18;&#x5148;&#x7EA7;"><br><a href="http://tool.oschina.net/regex/" target="_blank" rel="external">&#x6B63;&#x5219;&#x5728;&#x7EBF;&#x6D4B;&#x8BD5;&#x5DE5;&#x5177;</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-okhttp源码分析" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/26/okhttp源码分析/" class="article-date">
  	<time datetime="2016-02-26T11:12:59.000Z" itemprop="datePublished">2016-02-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/26/okhttp源码分析/">okhttp源码分析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="&#x5728;&#x524D;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5DF2;&#x7ECF;&#x5B66;&#x4E60;&#x4E86;Retrofit&#x548C;Okhttp&#x7684;&#x57FA;&#x672C;&#x7528;&#x6CD5;&#xFF0C;&#x4ECA;&#x5929;&#x6211;&#x5C31;&#x8981;&#x5F00;&#x59CB;&#x7B2C;&#x4E09;&#x90E8;&#x5206;Why&#x7684;&#x5B66;&#x4E60;&#x3002;&#x7B2C;&#x4E00;&#x6B21;&#x8BA4;&#x771F;&#x7684;&#x9605;&#x8BFB;&#x4E00;&#x4E2A;&#x7B2C;&#x4E09;&#x65B9;&#x5F00;&#x6E90;&#x5E93;&#x7684;&#x5185;&#x90E8;&#x4EE3;&#x7801;&#xFF0C;&#x6DF1;&#x5165;&#x7406;&#x89E3;okttp&#x548C;Retroft&#x7684;&#x5B9E;&#x73B0;&#x8FC7;&#x7A0B;&#xFF0C;&#x7531;&#x4E8E;Retrofit&#x7684;&#x7F51;&#x7EDC;&#x901A;&#x8BAF;&#x7684;&#x5B9E;&#x73B0;&#x5168;&#x90E8;&#x57FA;&#x4E8E;okhttp&#xFF0C;&#x56E0;&#x6B64;&#x9996;&#x5148;&#x6211;&#x5C06;&#x5F00;&#x59CB;&#x5BF9;okhttp&#x6E90;&#x7801;&#x7684;&#x5B66;&#x4E60;&#x3002;">&#x5728;&#x524D;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5DF2;&#x7ECF;&#x5B66;&#x4E60;&#x4E86;Retrofit&#x548C;Okhttp&#x7684;&#x57FA;&#x672C;&#x7528;&#x6CD5;&#xFF0C;&#x4ECA;&#x5929;&#x6211;&#x5C31;&#x8981;&#x5F00;&#x59CB;&#x7B2C;&#x4E09;&#x90E8;&#x5206;Why&#x7684;&#x5B66;&#x4E60;&#x3002;&#x7B2C;&#x4E00;&#x6B21;&#x8BA4;&#x771F;&#x7684;&#x9605;&#x8BFB;&#x4E00;&#x4E2A;&#x7B2C;&#x4E09;&#x65B9;&#x5F00;&#x6E90;&#x5E93;&#x7684;&#x5185;&#x90E8;&#x4EE3;&#x7801;&#xFF0C;&#x6DF1;&#x5165;&#x7406;&#x89E3;okttp&#x548C;Retroft&#x7684;&#x5B9E;&#x73B0;&#x8FC7;&#x7A0B;&#xFF0C;&#x7531;&#x4E8E;Retrofit&#x7684;&#x7F51;&#x7EDC;&#x901A;&#x8BAF;&#x7684;&#x5B9E;&#x73B0;&#x5168;&#x90E8;&#x57FA;&#x4E8E;okhttp&#xFF0C;&#x56E0;&#x6B64;&#x9996;&#x5148;&#x6211;&#x5C06;&#x5F00;&#x59CB;&#x5BF9;okhttp&#x6E90;&#x7801;&#x7684;&#x5B66;&#x4E60;&#x3002;</h5><hr>
<h2 id="&#x6309;&#x7167;&#x60EF;&#x4F8B;&#xFF0C;&#x6211;&#x5206;&#x4E09;&#x90E8;&#x5206;&#x5F00;&#x59CB;&#x5BF9;okhttp&#x7684;&#x89E3;&#x6790;&#x3002;">&#x6309;&#x7167;&#x60EF;&#x4F8B;&#xFF0C;&#x6211;&#x5206;&#x4E09;&#x90E8;&#x5206;&#x5F00;&#x59CB;&#x5BF9;okhttp&#x7684;&#x89E3;&#x6790;&#x3002;</h2><p>###1.What?<br>okhttp&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x5B83;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#xFF1F;&#x6211;&#x76F4;&#x63A5;&#x5F15;&#x7528;&#x5B98;&#x65B9;&#x7684;&#x4ECB;&#x7ECD;&#x5982;&#x4E0B;</p>
<blockquote>
<p>Overview</p>
<p>HTTP is the way modern applications network. It&#x2019;s how we exchange data &amp; media. Doing HTTP efficiently makes your stuff load faster and saves bandwidth.<br>OkHttp is an HTTP client that&#x2019;s efficient by default:</p>
<p>HTTP/2 support allows all requests to the same host to share a socket.<br>Connection pooling reduces request latency (if HTTP/2 isn&#x2019;t available).<br>Transparent GZIP shrinks download sizes.<br>Response caching avoids the network completely for repeat requests.<br>OkHttp perseveres when the network is troublesome: it will silently recover from common connection problems. If your service has multiple IP addresses OkHttp will attempt alternate addresses if the first connect fails. This is necessary for IPv4+IPv6 and for services hosted in redundant data centers. OkHttp initiates new connections with modern TLS features (SNI, ALPN), and falls back to TLS 1.0 if the handshake fails.</p>
<p>Using OkHttp is easy. Its request/response API is designed with fluent builders and immutability. It supports both synchronous blocking calls and async calls with callbacks.</p>
<p>OkHttp supports Android 2.3 and above. For Java, the minimum requirement is 1.7.</p>
</blockquote>
<p>&#x6839;&#x636E;&#x5B98;&#x65B9;&#x4ECB;&#x7ECD;&#xFF1A;okhttp&#x662F;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7F51;&#x7EDC;&#x5E93;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x7528;&#x66F4;&#x5C11;&#x7684;&#x5E26;&#x5BBD;&#x548C;&#x66F4;&#x5FEB;&#x7684;&#x901F;&#x5EA6;&#x53BB;&#x4EA4;&#x6362;&#x6570;&#x636E;&#xFF0C;&#x6709;&#x7528;&#x7684;&#x4F7F;&#x7528;HTTP&#x3002;<br>&#x5B83;&#x9ED8;&#x8BA4;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x529F;&#x80FD;&#xFF1A;</p>
<ul>
<li>&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x53D1;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8BF7;&#x6C42;&#x5206;&#x4EAB;socket</li>
<li>&#x4F7F;&#x7528;&#x94FE;&#x63A5;&#x6C60;&#x7684;&#x8BBE;&#x8BA1;&#x6765;&#x51CF;&#x5C11;&#x8BF7;&#x6C42;&#x7684;&#x5EF6;&#x8FDF;</li>
<li>&#x4F7F;&#x7528;GZIP&#x538B;&#x7F29;&#x65B9;&#x5F0F;&#x51CF;&#x5C11;&#x4ECE;&#x670D;&#x52A1;&#x7AEF;&#x4E0B;&#x8F7D;&#x7684;&#x6570;&#x636E;&#x91CF;</li>
<li>&#x5BF9;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x56DE;&#x5E94;&#x4F7F;&#x7528;cache&#x907F;&#x514D;&#x591A;&#x6B21;&#x53D1;&#x9001;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x7684;&#x8BF7;&#x6C42;<br>okhttp&#x4F7F;&#x7528;&#x91CD;&#x8FDE;&#x673A;&#x5236;&#xFF0C;&#x5F53;&#x7F51;&#x7EDC;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x9759;&#x9ED8;&#x7684;&#x6062;&#x590D;&#xFF0C;&#x5E76;&#x4E14;&#x5F53;&#x4F60;&#x8FDE;&#x63A5;&#x7684;&#x670D;&#x52A1;&#x6709;&#x591A;&#x4E2A;IP&#x5730;&#x5740;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5931;&#x8D25;&#x540E;&#x8C03;&#x7528;&#x7B2C;&#x4E8C;&#x4E2A;&#x53BB;&#x5C1D;&#x8BD5;&#x3002;<br>okhttp&#x540C;&#x65F6;&#x652F;&#x6301;&#x540C;&#x6B65;&#x8C03;&#x7528;&#x548C;&#x5F02;&#x6B65;&#x8C03;&#x7528;&#x3002;</li>
</ul>
<hr>
<p>###2&amp;3.How&amp;Why?</p>
<p>&#x9996;&#x5148;&#x4ECE;&#x6211;&#x4EEC;&#x7684;&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x5F00;&#x59CB;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x6DF1;&#x5165;&#x5230;&#x5185;&#x90E8;&#x7684;&#x5B9E;&#x73B0;&#x3002;<br>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x6BCF;&#x6B21;&#x4F7F;&#x7528;okhttp&#x7684;&#x6700;&#x7B80;&#x5355;&#x6D41;&#x7A0B;&#x3002;</p>
<p>&#x83B7;&#x53D6;&#x4E00;&#x4E2A;URL&#x7684;&#x5185;&#x5BB9;</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;okhttpclient&#x5BF9;&#x8C61;</span></span><br><span class="line">OkHttpClient mOkHttpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"><span class="comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Request</span></span><br><span class="line"><span class="keyword">final</span> Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">                .url(<span class="string">&quot;www.baidu.com&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line"><span class="comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;call</span></span><br><span class="line"><span class="keyword">Call</span> <span class="keyword">call</span> = mOkHttpClient.newCall(request); </span><br><span class="line"><span class="comment">//&#x4EE4;call&#x8FDB;&#x5165;&#x961F;&#x5217;&#x7B49;&#x5F85;&#x6267;&#x884C;</span></span><br><span class="line"><span class="keyword">call</span>.enqueue(<span class="keyword">new</span> Callback()</span><br><span class="line">        {</span><br><span class="line">            @Override</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> onFailure(Request request, IOException e)</span><br><span class="line">            {</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            @Override</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> onResponse(<span class="keyword">final</span> Response response) <span class="keyword">throws</span> IOException</span><br><span class="line">            {</span><br><span class="line">                    </span><br><span class="line">            }</span><br><span class="line">        });       </span><br><span class="line">```      </span><br><span class="line">&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x6700;&#x7B80;&#x5355;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x3002;</span><br><span class="line"></span><br><span class="line">&#x6765;&#x7B80;&#x5355;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x3002;</span><br><span class="line"><span class="number">1</span>.&#x521B;&#x5EFA;&#x4E00;&#x4E2A;OkhttpClient&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x662F;&#x4F7F;&#x7528;okhttp&#x6240;&#x6709;&#x529F;&#x80FD;&#x7684;&#x7B2C;&#x4E00;&#x6B65;&#x3002;</span><br><span class="line"><span class="number">2</span>.&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Request&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4F7F;&#x7528;&#x4E86;&#x5EFA;&#x9020;&#x8005;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x7684;&#x4F18;&#x70B9;&#x662F;&#x7B80;&#x5316;&#x7E41;&#x7410;&#x7684;&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;&#xFF0C;&#x4F7F;&#x5BF9;&#x8C61;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x5185;&#x90E8;&#x7684;&#x5B9E;&#x73B0;&#x5206;&#x79BB;&#xFF0C;&#x8BA9;&#x5BA2;&#x6237;&#x7AEF;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x66F4;&#x7CBE;&#x7EC6;&#x7684;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x9700;&#x6C42;&#x521B;&#x9020;&#x5BF9;&#x5E94;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;&#x5EFA;&#x9020;&#x8005;&#x6A21;&#x5F0F;&#xFF0C;request&#x7684;&#x521B;&#x5EFA;&#x903B;&#x8F91;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x6E05;&#x6670;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x4F8B;&#x5B50;&#x4E2D;&#x6211;&#x4EEC;&#x53EA;&#x8BBE;&#x7F6E;&#x4E86;url&#xFF0C;&#x4F46;&#x6839;&#x636E;&#x9700;&#x6C42;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x590D;&#x6742;&#x5F97;&#x591A;&#x7684;request&#x3002;</span><br><span class="line"><span class="number">3</span>.&#x8C03;&#x7528;client&#x7684;&#x65B9;&#x6CD5;&#x5C06;request&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;<span class="keyword">call</span>&#xFF0C;&#x5728;okhttp&#x4E2D;request&#x5E76;&#x4E0D;&#x80FD;&#x88AB;&#x76F4;&#x63A5;&#x6267;&#x884C;&#xFF0C;&#x9700;&#x8981;&#x5BF9;request&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#xFF0C;&#x5728;&#x6700;&#x540E;&#x6267;&#x884C;<span class="keyword">call</span>&#x3002;</span><br><span class="line"><span class="number">4</span>.&#x6267;&#x884C;&#x5C01;&#x88C5;&#x597D;&#x7684;<span class="keyword">call</span>&#x3002;&#x67E5;&#x770B;&#x6E90;&#x7801;&#x53EF;&#x4EE5;&#x770B;&#x5230;okhttp&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x79CD;&#x6267;&#x884C;&#x65B9;&#x5F0F;&#xFF0C;execute()&#x548C;enqueue()&#xFF0C;&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x7684;&#x533A;&#x522B;&#x4ECE;&#x540D;&#x5B57;&#x4E0A;&#x5C31;&#x80FD;&#x770B;&#x51FA;&#x6765;&#x5927;&#x6982;&#xFF0C;&#x7A0D;&#x540E;&#x6211;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x67E5;&#x770B;&#x6E90;&#x7801;&#x7684;&#x6CE8;&#x91CA;&#x53EF;&#x4EE5;&#x770B;&#x5230;</span><br></pre></td></tr></table></figure>
<p>/**</p>
<ul>
<li>A call is a request that has been prepared for execution. A call can be</li>
<li>canceled. As this object represents a single request/response pair (stream),</li>
<li>it cannot be executed twice.<br>*/</li>
</ul>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x8FD9;&#x91CC;&#x660E;&#x786E;&#x7684;&#x6307;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;<span class="keyword">call</span>&#x5BF9;&#x8C61;&#x53EA;&#x80FD;&#x88AB;&#x6267;&#x884C;&#x4E00;&#x6B21;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x60F3;&#x8981;&#x591A;&#x6B21;&#x6267;&#x884C;&#x76F8;&#x540C;&#x7684;<span class="built_in">request</span>&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x53E6;&#x60F3;&#x529E;&#x6CD5;&#x3002;</span><br><span class="line"></span><br><span class="line">&#x597D;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x4ECE;&#x6E90;&#x7801;&#x5165;&#x624B;&#xFF0C;&#x5206;&#x6790;&#x4E00;&#x4E2A;<span class="built_in">request</span>&#x4ECE;&#x521B;&#x5EFA;&#x5230;&#x88AB;&#x6267;&#x884C;&#x7684;&#x6240;&#x6709;&#x8FC7;&#x7A0B;&#x3002;</span><br><span class="line">&#x6211;&#x4EEC;&#x6BCF;&#x4E00;&#x6B21;&#x4F7F;&#x7528;&#x90FD;&#x8981;&#x521B;&#x5EFA;OkhttpClient&#x3002;</span><br></pre></td></tr></table></figure>
<p>/**</p>
<ul>
<li>Configures and creates HTTP connections. Most applications can use a single</li>
<li>OkHttpClient for all of their HTTP requests - benefiting from a shared</li>
<li>response cache, thread pool, connection re-use, etc.<br>*</li>
<li><p>Instances of OkHttpClient are intended to be fully configured before they&#x2019;re</p></li>
<li>shared - once shared they should be treated as immutable and can safely be used</li>
<li>to concurrently open new connections. If required, threads can call</li>
<li>{@link #clone()} to make a shallow copy of the OkHttpClient that can be</li>
<li><p>safely modified with further configuration changes.<br>*/</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x8FD9;&#x662F;&#x5B98;&#x65B9;&#x5BF9;&#x4E8E;OkHttpClient&#x7684;&#x6CE8;&#x91CA;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;OkHttpClient&#x662F;&#x7528;&#x4E8E;&#x914D;&#x7F6E;&#x6211;&#x4EEC;&#x7684;&#x8FDE;&#x63A5;&#x9700;&#x6C42;&#x6240;&#x8BBE;&#x8BA1;&#x51FA;&#x6765;&#x7684;&#x7C7B;&#xFF0C;&#x5F53;OkHttpClient&#x5B9E;&#x4F8B;&#x5316;&#x540E;&#x5B83;&#x5E94;&#x5F53;&#x662F;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x4E14;&#x53EF;&#x5B89;&#x5168;&#x7684;&#x540C;&#x65F6;&#x5F00;&#x542F;&#x591A;&#x4E2A;&#x8FDE;&#x63A5;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4FEE;&#x6539;OkHttpClient&#x5B9E;&#x4F8B;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<span class="function"><span class="title">clone</span><span class="params">()</span></span>&#x6765;&#x83B7;&#x53D6;&#x4E00;&#x4EFD;&#x5907;&#x4EFD;&#x6765;&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x7684;&#x4FEE;&#x6539;&#x3002;</span><br><span class="line"></span><br><span class="line">&#x8FD9;&#x662F;&#x88AB;&#x6211;&#x4EEC;&#x8C03;&#x7528;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</span><br></pre></td></tr></table></figure>
<p>public OkHttpClient() {<br> routeDatabase = new RouteDatabase();<br> dispatcher = new Dispatcher();<br>}</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;OkHttpClient&#x5B9E;&#x4F8B;&#x90FD;&#x5185;&#x5D4C;&#x7740;&#x4E00;&#x4E2A;routeDatabase&#x5B9E;&#x4F8B;&#x548C;&#x4E00;&#x4E2A;dispatcher&#x5B9E;&#x4F8B;&#xFF0C;&#x6DF1;&#x5165;&#x8FD9;&#x4E24;&#x4E2A;&#x7C7B;&#x7684;&#x5185;&#x90E8;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E86;&#x89E3;&#x8FD9;&#x4E24;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x4F5C;&#x7528;&#x3002;</span><br></pre></td></tr></table></figure>
<p>/**</p>
<ul>
<li>A blacklist of failed routes to avoid when creating a new connection to a</li>
<li>target address. This is used so that OkHttp can learn from its mistakes: if</li>
<li>there was a failure attempting to connect to a specific IP address or proxy</li>
<li>server, that failure is remembered and alternate routes are preferred.<br>*/<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;RouteDatabase&#x7C7B;&#x6B63;&#x5982;&#x5B83;&#x7684;&#x540D;&#x5B57;&#x4E00;&#x6837;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x8DEF;&#x7EBF;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5B83;&#x8D1F;&#x8D23;OkHttpClient&#x53D1;&#x8D77;&#x7684;&#x5931;&#x8D25;&#x7684;Connection&#xFF0C;&#x5C06;&#x5B83;&#x52A0;&#x5165;&#x9ED1;&#x540D;&#x5355;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#x591A;<span class="literal">IP</span>&#x91CD;&#x8FDE;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x8BB0;&#x5F55;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;&#x3002;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>public final class RouteDatabase {<br>  private final Set<route> failedRoutes = new LinkedHashSet&lt;&gt;();<br>  }<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RouteDatabase&#x5185;&#x542B;&#x4E00;&#x4E2A;LinkedHashSet&#x6765;&#x8BB0;&#x5F55;&#x6240;&#x6709;&#x7684;&#x5931;&#x8D25;&#x8FDE;&#x63A5;&#xFF0C;&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x5B9E;&#x73B0;&#x5230;&#x8FD9;&#x91CC;&#x5DF2;&#x7ECF;&#x5F88;&#x6E05;&#x695A;&#x4E86;&#x3002;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;Dispatcher&#x7C7B;&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x3002;</span><br></pre></td></tr></table></figure></route></p>
<p>/**</p>
<ul>
<li>Policy on when async requests are executed.<br>*</li>
<li><p>Each dispatcher uses an {@link ExecutorService} to run calls internally. If you</p></li>
<li>supply your own executor, it should be able to run {@linkplain #getMaxRequests the</li>
<li>configured maximum} number of calls concurrently.<br>*/<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;<span class="variable">Dispatcher</span>&#x662F;&#x4E00;&#x4E2A;&#x8C03;&#x5EA6;&#x5668;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x7684;<span class="variable">OkHttpClient</span>&#x6267;&#x884C;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x65F6;&#xFF0C;<span class="variable">Dispatcher</span>&#x8D1F;&#x8D23;&#x63A7;&#x5236;&#x5404;&#x4E2A;&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x3002;</span><br><span class="line">&#x770B;&#x5230;<span class="variable">ExecutorService</span>&#x65F6;&#x5C31;&#x5E94;&#x8BE5;&#x77E5;&#x9053;&#x4E86;&#xFF0C;&#x8FD9;&#x4E2A;<span class="variable">Dispatcher</span>&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x5E94;&#x8BE5;&#x5C31;&#x662F;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5E76;&#x4E14;<span class="ok">ok</span>http&#x8FD8;&#x652F;&#x6301;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;<span class="function_or_atom">executor</span>&#xFF0C;&#x81EA;&#x5DF1;&#x6765;&#x63A7;&#x5236;&#x5404;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x3002;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>public final class Dispatcher {<br>  private int maxRequests = 64;<br>  private int maxRequestsPerHost = 5;</p>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span> Ready calls in the order they&apos;ll be run. <span class="keyword">*</span>/
</code></pre><p>  private final Deque<asynccall> readyCalls = new ArrayDeque&lt;&gt;();</asynccall></p>
<p>  /<em>* Running calls. Includes canceled calls that haven&#x2019;t finished yet. </em>/<br>  private final Deque<asynccall> runningCalls = new ArrayDeque&lt;&gt;();</asynccall></p>
<p>  /<em>* In-flight synchronous calls. Includes canceled calls that haven&#x2019;t finished yet. </em>/<br>  private final Deque<call> executedCalls = new ArrayDeque&lt;&gt;();<br>  }<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x8FD9;&#x662F;Dispatcher&#x5185;&#x90E8;&#x7684;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5728;&#x9ED8;&#x8BA4;&#x7684;&#x60C5;&#x51B5;&#x4E0B;okhttp&#x6700;&#x591A;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x662F;<span class="number">64</span>&#x4E2A;&#xFF0C;&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x7AEF;&#x662F;<span class="number">5</span>&#x4E2A;&#x3002;</span><br><span class="line">Dispatcher&#x5185;&#x90E8;&#x4F7F;&#x7528;Deque&#x8FD9;&#x79CD;&#x53CC;&#x7AEF;&#x961F;&#x5217;&#x7BA1;&#x7406;AsyncCall&#xFF0C;&#x5373;&#x5F02;&#x6B65;Call&#xFF0C;&#x5BF9;Dispatcher&#x7684;&#x5206;&#x6790;&#x5230;&#x8FD9;&#x91CC;&#x7ED3;&#x675F;&#x3002;</span><br><span class="line"></span><br><span class="line">&#x7B80;&#x5355;&#x7684;&#x770B;&#x4E86;&#x4E00;&#x4E0B;OkHttpClient&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x8FDB;&#x5165;Request&#xFF0C;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x88AB;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x7684;Request&#x3002;</span><br><span class="line"></span><br><span class="line">```  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> HttpUrl url;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String <span class="function"><span class="keyword">method</span>;</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Headers headers;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> RequestBody body;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Object tag;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> URL javaNetUrl; <span class="comment">// Lazily initialized.</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> URI javaNetUri; <span class="comment">// Lazily initialized.</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> CacheControl cacheControl; <span class="comment">// Lazily initialized.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Request(Builder builder) <span class="comment">{</span><br><span class="line">    this.url = builder.url;</span><br><span class="line">    this.method = builder.method;</span><br><span class="line">    this.headers = builder.headers.build();</span><br><span class="line">    this.body = builder.body;</span><br><span class="line">    this.tag = builder.tag != null ? builder.tag : this;</span><br><span class="line">  }</span></span><br></pre></td></tr></table></figure></call></p>
<p>&#x8FDB;&#x5165;Request&#x5185;&#x90E8;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x8FD9;&#x91CC;&#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x5B9E;&#x9645;&#x7684;&#x903B;&#x8F91;&#xFF0C;Request&#x7C7B;&#x672C;&#x8EAB;&#x53EA;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x4EFB;&#x52A1;&#x7684;&#x62BD;&#x8C61;&#x96C6;&#x5408;&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x624D;&#x662F;&#x771F;&#x6B63;&#x6709;&#x6548;&#x7684;&#x903B;&#x8F91;&#x5B9E;&#x73B0;&#x4F53;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x53BB;&#x67E5;&#x770B;Call&#x8FD9;&#x4E2A;&#x7C7B;&#xFF0C;&#x53BB;&#x89C2;&#x5BDF;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x88AB;&#x6267;&#x884C;&#x7684;&#x8FC7;&#x7A0B;&#x3002;</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * A <span class="keyword">call</span> <span class="keyword">is</span> a request that has been prepared <span class="keyword">for</span> execution. A <span class="keyword">call</span> can be</span><br><span class="line"> * canceled. <span class="keyword">As</span> this <span class="built_in">object</span> represents a <span class="built_in">single</span> request/response pair (stream),</span><br><span class="line"> * it cannot be executed twice.</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
<p>&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#xFF0C;&#x4E00;&#x4E2A;Call&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x88AB;&#x6267;&#x884C;&#x7684;Request&#xFF0C;Call&#x53EF;&#x4EE5;&#x88AB;&#x53D6;&#x6D88;&#x6267;&#x884C;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x4E2A;Call&#x4EE3;&#x8868;&#x4E00;&#x4E2A;Request&#x548C;Response&#x5BF9;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4E2A;call&#x4E0D;&#x80FD;&#x88AB;&#x6267;&#x884C;&#x4E24;&#x6B21;&#x3002;<br>&#x521B;&#x5EFA;Call&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Call(OkHttpClient <span class="keyword">client</span>, Request originalRequest) {</span><br><span class="line">  <span class="comment">// Copy the client. Otherwise changes (socket factory, redirect policy,</span></span><br><span class="line">  <span class="comment">// etc.) may incorrectly be reflected in the request when it is executed.</span></span><br><span class="line">  <span class="keyword">this</span>.<span class="keyword">client</span> = <span class="keyword">client</span>.copyWithDefaults();</span><br><span class="line">  <span class="keyword">this</span>.originalRequest = originalRequest;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6CE8;&#x610F;&#x5230;&#x8FD9;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x662F;protected&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x80FD;&#x624B;&#x52A8;new&#x51FA;&#x4E00;&#x4E2A;call&#xFF0C;&#x8FD9;&#x7B26;&#x5408;&#x903B;&#x8F91;&#xFF0C;&#x6211;&#x4EEC;&#x6BCF;&#x6B21;&#x60F3;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;call&#x90FD;&#x8981;&#x901A;&#x8FC7;OkHttpClient&#x7684;newCall()&#x65B9;&#x6CD5;,&#x8FD9;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x5728;&#x8FD9;&#x91CC;&#x88AB;&#x8C03;&#x7528;&#x3002;</p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">  * Prepares <span class="name">the</span> {@code request} <span class="name">to</span> <span class="name">be</span> <span class="name">executed</span> <span class="name">at</span> <span class="name">some</span> <span class="name">point</span> <span class="name">in</span> <span class="name">the</span> <span class="name">future</span>.</span><br><span class="line">  */</span><br><span class="line"> public Call newCall(Request request) {</span><br><span class="line">   return new Call(this, request);</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6765;&#x89C2;&#x5BDF;Call&#x7684;execute()&#x65B9;&#x6CD5;</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public <span class="type">Response</span> execute() throws <span class="type">IOException</span> {</span><br><span class="line">  synchronized (this) {</span><br><span class="line">    <span class="keyword">if</span> (executed) throw new <span class="type">IllegalStateException</span>(<span class="string">&quot;Already Executed&quot;</span>);</span><br><span class="line">    executed = <span class="literal">true</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    client.getDispatcher().executed(this);</span><br><span class="line">    <span class="type">Response</span> <span class="literal">result</span> = getResponseWithInterceptorChain(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">result</span> == null) throw new <span class="type">IOException</span>(<span class="string">&quot;Canceled&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">  } <span class="keyword">finally</span> {</span><br><span class="line">    client.getDispatcher().finished(this);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5230;&#x8FD9;&#x91CC;Call&#x7684;&#x6267;&#x884C;&#x6D41;&#x7A0B;&#x5DF2;&#x7ECF;&#x5F88;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x4E00;&#x4E2A;Call&#x8981;&#x88AB;&#x6267;&#x884C;&#x9996;&#x5148;&#x8981;&#x88AB;&#x521B;&#x5EFA;&#x8FD9;&#x4E2A;Call&#x7684;OkHttpClient&#x91CC;&#x7684;Dispatcher&#x8C03;&#x7528;&#x52A0;&#x5165;&#x961F;&#x5217;&#x7B49;&#x5F85;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6DF1;&#x5165;Dispatcher&#x7684;executed&#x7684;&#x5185;&#x90E8;&#x9605;&#x8BFB;&#x5176;&#x5B9E;&#x73B0;&#x3002;</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> <span class="keyword">void</span> executed(<span class="keyword">Call</span> <span class="keyword">call</span>) {</span><br><span class="line">  executedCalls.add(<span class="keyword">call</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p> &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x91CC;&#x53EA;&#x6709;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x770B;&#x6765;&#x8FD8;&#x8981;&#x7EE7;&#x7EED;&#x5411;&#x4E0B;&#x627E;&#x5B83;&#x7684;&#x771F;&#x6B63;&#x5B9E;&#x73B0;&#xFF0C;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;executedCalls&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x63D0;&#x5230;&#x7684;Deque&#xFF0C;&#x5B83;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#x3002;&#x8FD9;&#x4E2A;&#x62BD;&#x8C61;&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x662F;ArrayDeque&#xFF0C;&#x6765;&#x770B;&#x770B;add&#x65B9;&#x6CD5;&#x3002;</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>{</span><br><span class="line">    addLast(e);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x663E;&#x7136;&#xFF0C;&#x8FD9;&#x4E2A;add&#x65B9;&#x6CD5;&#x628A;&#x6211;&#x4EEC;&#x8981;&#x6267;&#x884C;&#x7684;Call&#x52A0;&#x5165;&#x5230;&#x4E86;&#x961F;&#x5217;&#x7684;&#x961F;&#x5C3E;&#x6392;&#x961F;&#xFF0C;&#x8BA9;&#x8FD9;&#x4E2A;request&#x7B49;&#x5F85;&#x6267;&#x884C;&#x3002;<br>&#x90A3;&#x4E48;&#x961F;&#x5217;&#x91CC;&#x7684;Call&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x624D;&#x4F1A;&#x88AB;&#x771F;&#x6B63;&#x6267;&#x884C;&#x5462;&#xFF1F;&#x4E0B;&#x9762;&#x8FD4;&#x56DE;Call()&#x7684;execute()&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x770B;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5728;finish&#x548C;executed&#x4E4B;&#x95F4;&#x7684;getResponseWithInterceptorChain&#x65B9;&#x6CD5;&#xFF0C;&#x770B;&#x6765;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x5B9E;&#x9645;&#x6267;&#x884C;&#x90E8;&#x5206;&#xFF0C;&#x8FDB;&#x5165;&#x89C2;&#x5BDF;&#x3002;</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Override <span class="keyword">public</span> Response proceed(Request request) throws IOException {</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">index</span> &lt; <span class="keyword">client</span>.interceptors().size()) {</span><br><span class="line">     <span class="comment">// There&apos;s another interceptor in the chain. Call that.</span></span><br><span class="line">     Interceptor.Chain chain = <span class="keyword">new</span> ApplicationInterceptorChain(<span class="keyword">index</span> + <span class="number">1</span>, request, forWebSocket);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">client</span>.interceptors().get(<span class="keyword">index</span>).intercept(chain);</span><br><span class="line">   } <span class="keyword">else</span> {</span><br><span class="line">     <span class="comment">// No more interceptors. Do HTTP.</span></span><br><span class="line">     <span class="keyword">return</span> getResponse(request, forWebSocket);</span><br><span class="line">   }</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>
<p>getResponse&#x5C31;&#x662F;&#x5B9E;&#x9645;&#x6267;&#x884C;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Performs the request and returns the response. May return null if this</span><br><span class="line"> * call was canceled.</span><br><span class="line"> */</span></span><br><span class="line">Response getResponse<span class="params">(Request request, boolean forWebSocket)</span> throws IOException {</span><br><span class="line">  <span class="comment">// Copy body metadata to the appropriate request headers.</span></span><br><span class="line">  RequestBody body = request.body<span class="params">()</span>;</span><br><span class="line">  <span class="keyword">if</span> <span class="params">(body != null)</span> {</span><br><span class="line">    Request.Builder requestBuilder = request.newBuilder<span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    MediaType contentType = body.contentType<span class="params">()</span>;</span><br><span class="line">    <span class="keyword">if</span> <span class="params">(contentType != null)</span> {</span><br><span class="line">      requestBuilder.header<span class="params">(<span class="string">&quot;Content-Type&quot;</span>, contentType.toString<span class="params">()</span>)</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    long contentLength = body.contentLength<span class="params">()</span>;</span><br><span class="line">    <span class="keyword">if</span> <span class="params">(contentLength != -<span class="number">1</span>)</span> {</span><br><span class="line">      requestBuilder.header<span class="params">(<span class="string">&quot;Content-Length&quot;</span>, Long.toString<span class="params">(contentLength)</span>)</span>;</span><br><span class="line">      requestBuilder.removeHeader<span class="params">(<span class="string">&quot;Transfer-Encoding&quot;</span>)</span>;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      requestBuilder.header<span class="params">(<span class="string">&quot;Transfer-Encoding&quot;</span>, <span class="string">&quot;chunked&quot;</span>)</span>;</span><br><span class="line">      requestBuilder.removeHeader<span class="params">(<span class="string">&quot;Content-Length&quot;</span>)</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    request = requestBuilder.build<span class="params">()</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create the initial HTTP engine. Retries and redirects need new engine for each attempt.</span></span><br><span class="line">  engine = new HttpEngine<span class="params">(client, request, <span class="literal">false</span>, <span class="literal">false</span>, forWebSocket, null, null, null, null)</span>;</span><br><span class="line"></span><br><span class="line">  int followUpCount = <span class="number">0</span>;</span><br><span class="line">  while <span class="params">(<span class="literal">true</span>)</span> {</span><br><span class="line">    <span class="keyword">if</span> <span class="params">(canceled)</span> {</span><br><span class="line">      engine.releaseConnection<span class="params">()</span>;</span><br><span class="line">      throw new IOException<span class="params">(<span class="string">&quot;Canceled&quot;</span>)</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    try {</span><br><span class="line">      engine.sendRequest<span class="params">()</span>;</span><br><span class="line">      engine.readResponse<span class="params">()</span>;</span><br><span class="line">    } catch <span class="params">(RequestException e)</span> {</span><br><span class="line">      <span class="comment">// The attempt to interpret the request failed. Give up.</span></span><br><span class="line">      throw e.getCause<span class="params">()</span>;</span><br><span class="line">    } catch <span class="params">(RouteException e)</span> {</span><br><span class="line">      <span class="comment">// The attempt to connect via a route failed. The request will not have been sent.</span></span><br><span class="line">      HttpEngine retryEngine = engine.recover<span class="params">(e)</span>;</span><br><span class="line">      <span class="keyword">if</span> <span class="params">(retryEngine != null)</span> {</span><br><span class="line">        engine = retryEngine;</span><br><span class="line">        continue;</span><br><span class="line">      }</span><br><span class="line">      <span class="comment">// Give up; recovery is not possible.</span></span><br><span class="line">      throw e.getLastConnectException<span class="params">()</span>;</span><br><span class="line">    } catch <span class="params">(IOException e)</span> {</span><br><span class="line">      <span class="comment">// An attempt to communicate with a server failed. The request may have been sent.</span></span><br><span class="line">      HttpEngine retryEngine = engine.recover<span class="params">(e, null)</span>;</span><br><span class="line">      <span class="keyword">if</span> <span class="params">(retryEngine != null)</span> {</span><br><span class="line">        engine = retryEngine;</span><br><span class="line">        continue;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Give up; recovery is not possible.</span></span><br><span class="line">      throw e;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Response response = engine.getResponse<span class="params">()</span>;</span><br><span class="line">    Request followUp = engine.followUpRequest<span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="params">(followUp == null)</span> {</span><br><span class="line">      <span class="keyword">if</span> <span class="params">(!forWebSocket)</span> {</span><br><span class="line">        engine.releaseConnection<span class="params">()</span>;</span><br><span class="line">      }</span><br><span class="line">      return response;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="params">(++followUpCount &gt; MAX_FOLLOW_UPS)</span> {</span><br><span class="line">      throw new ProtocolException<span class="params">(<span class="string">&quot;Too many follow-up requests: &quot;</span> + followUpCount)</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="params">(!engine.sameConnection<span class="params">(followUp.httpUrl<span class="params">()</span>)</span>)</span> {</span><br><span class="line">      engine.releaseConnection<span class="params">()</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Connection connection = engine.close<span class="params">()</span>;</span><br><span class="line">    request = followUp;</span><br><span class="line">    engine = new HttpEngine<span class="params">(client, request, <span class="literal">false</span>, <span class="literal">false</span>, forWebSocket, connection, null, null,</span><br><span class="line">        response)</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x5185;&#x5BB9;&#x975E;&#x5E38;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7C97;&#x7565;&#x7684;&#x5206;&#x4E3A;&#x4E24;&#x90E8;&#x5206;<br>1.&#x91CD;&#x5EFA;request&#xFF0C;&#x5BF9;&#x5176;&#x505A;&#x4E00;&#x4E9B;&#x4FEE;&#x6B63;&#xFF0C;&#x4E0D;&#x6DF1;&#x5165;&#x63A2;&#x8BA8;&#x3002;<br>2.&#x521B;&#x5EFA;HttpEngine&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x53D6;&#x5F97;Response&#x3002;engine&#x91CC;&#x662F;&#x7F51;&#x7EDC;&#x901A;&#x8BAF;&#x7684;&#x5177;&#x4F53;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#xFF0C;GZIP&#x538B;&#x7F29;&#x4E5F;&#x5728;&#x8FD9;&#x91CC;&#x9762;&#x53D1;&#x6325;&#x4F5C;&#x7528;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x903B;&#x8F91;&#x975E;&#x5E38;&#x590D;&#x6742;&#x3002;<br>&#x5230;&#x8FD9;&#x91CC;&#x4E00;&#x4E2A;&#x540C;&#x6B65;&#x7684;request&#x8C03;&#x7528;&#x5C31;&#x5206;&#x6790;&#x5B8C;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x4E00;&#x90E8;&#x7684;request&#x8C03;&#x7528;&#x3002;</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(Callback responseCallback, <span class="keyword">boolean</span> forWebSocket)</span> </span>{</span><br><span class="line">  <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">    <span class="keyword">if</span> (executed) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Already Executed&quot;</span>);</span><br><span class="line">    executed = <span class="keyword">true</span>;</span><br><span class="line">  }</span><br><span class="line">  client.getDispatcher().enqueue(<span class="keyword">new</span> AsyncCall(responseCallback, forWebSocket));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x4E0E;&#x540C;&#x6B65;&#x8C03;&#x7528;&#x76F8;&#x540C;&#xFF0C;&#x8FD9;&#x91CC;&#x8FD8;&#x662F;&#x8C03;&#x7528;Dispatcher&#x8BA9;Request&#x8FDB;&#x5165;&#x961F;&#x5217;&#x7B49;&#x5F85;&#x6267;&#x884C;&#x3002;</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="function">ExecutorService <span class="title">getExecutorService</span><span class="params">()</span> </span>{</span><br><span class="line">  <span class="keyword">if</span> (executorService == <span class="keyword">null</span>) {</span><br><span class="line">    executorService = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE, <span class="number">60</span>, TimeUnit.SECONDS,</span><br><span class="line">        <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;(), Util.threadFactory(<span class="string">&quot;OkHttp Dispatcher&quot;</span>, <span class="keyword">false</span>));</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> executorService;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x91CC;&#x53D1;&#x73B0;&#x4E86;client&#x91CC;excutorService&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x539F;&#x6765;&#x5B83;&#x5C31;&#x662F;ThreadPoolExecutor&#x3002;<br>&#x6211;&#x622A;&#x53D6;ThreadPoolExecutor&#x7684;execute&#x65B9;&#x6CD5;&#x7684;&#x6CE8;&#x91CA;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* Executes the given task sometime in the future.  The task
* may execute in a new thread or in an existing pooled thread.
*
* If the task cannot be submitted for execution, either because this
* executor has been shutdown or because its capacity has been reached,
* the task is handled by the current {@code RejectedExecutionHandler}.

public void execute(Runnable command) {
}</span><br></pre></td></tr></table></figure>
<p>execute&#x63A5;&#x6536;&#x4E00;&#x4E2A;Runnable&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x771F;&#x6B63;&#x6267;&#x884C;&#x7684;&#x5B9E;&#x9645;&#x4E0A;&#x662F;Runnable&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x800C;AyncCall&#x6B63;&#x662F;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#x4E86;Runnable&#x7684;Call&#x7684;&#x5185;&#x90E8;&#x7C7B;&#xFF0C;&#x4ECE;&#x800C;&#x5F97;&#x77E5;&#x6267;&#x884C;&#x7684;&#x5C31;&#x662F;AyncCall&#x7684;&#x903B;&#x8F91;&#x3002;&#x4E5F;&#x5C31;&#x662F;AyncCall&#x7684;execute&#x65B9;&#x6CD5;&#x3002;</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@Override protected void execute<span class="params">()</span> {</span><br><span class="line">  boolean signalledCallback = <span class="literal">false</span>;</span><br><span class="line">  try {</span><br><span class="line">    Response response = getResponseWithInterceptorChain<span class="params">(forWebSocket)</span>;</span><br><span class="line">    <span class="keyword">if</span> <span class="params">(canceled)</span> {</span><br><span class="line">      signalledCallback = <span class="literal">true</span>;</span><br><span class="line">      responseCallback.onFailure<span class="params">(originalRequest, new IOException<span class="params">(<span class="string">&quot;Canceled&quot;</span>)</span>)</span>;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      signalledCallback = <span class="literal">true</span>;</span><br><span class="line">      responseCallback.onResponse<span class="params">(response)</span>;</span><br><span class="line">    }</span><br><span class="line">  } catch <span class="params">(IOException e)</span> {</span><br><span class="line">    <span class="keyword">if</span> <span class="params">(signalledCallback)</span> {</span><br><span class="line">      <span class="comment">// Do not signal the callback twice!</span></span><br><span class="line">      logger.<span class="built_in">log</span><span class="params">(Level.INFO, <span class="string">&quot;Callback failure for &quot;</span> + toLoggableString<span class="params">()</span>, e)</span>;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      responseCallback.onFailure<span class="params">(engine.getRequest<span class="params">()</span>, e)</span>;</span><br><span class="line">    }</span><br><span class="line">  } finally {</span><br><span class="line">    client.getDispatcher<span class="params">()</span>.finished<span class="params">(this)</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5230;&#x4E86;&#x8FD9;&#x91CC;&#xFF0C;&#x53C8;&#x770B;&#x5230;&#x4E86;&#x719F;&#x6089;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Response response = getResponseWithInterceptorChain<span class="list">(<span class="keyword">forWebSocket</span>)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>&#x4EE5;&#x540E;&#x7684;&#x903B;&#x8F91;&#x548C;&#x540C;&#x6B65;&#x8C03;&#x7528;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x3002;<br>&#x6211;&#x4EEC;&#x68B3;&#x7406;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x3002;<br><img src="http://d.pcs.baidu.com/thumbnail/993b67199dbbd8f5341fc33c0bd42096?fid=2104252820-250528-951178632980765&amp;time=1456556400&amp;sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-2BtawZrwj0f9j%2BNGjiiErCzGP5k%3D&amp;rt=sh&amp;expires=2h&amp;r=526005079&amp;sharesign=unknown&amp;size=c710_u500&amp;quality=100" alt="Alt text"><br>&#x672C;&#x6B21;&#x5230;&#x6B64;&#x7ED3;&#x675F;&#xFF0C;&#x66F4;&#x591A;&#x7EC6;&#x8282;&#x4EE5;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x5B66;&#x4E60;&#x3002;</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Retrofit学习记录" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/15/Retrofit学习记录/" class="article-date">
  	<time datetime="2015-12-15T13:27:28.000Z" itemprop="datePublished">2015-12-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/15/Retrofit学习记录/">Retrofit学习记录</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#x6700;&#x8FD1;&#x82B1;&#x4E86;&#x70B9;&#x65F6;&#x95F4;&#x4E86;&#x89E3;&#x5B66;&#x4E60;&#x4E86;&#x4E00;&#x4E0B;Retrofit&#x5E93;&#xFF0C;&#x73B0;&#x5728;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#x3002;</p>
<h2 id="&#x4E00;-What_Retrofit&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#xFF1F;">&#x4E00;.What &#x3000;Retrofit&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#xFF1F;</h2><p>Retrofit&#x662F;&#x4E00;&#x4E2A;Android&#x4E0B;&#x975E;&#x5E38;&#x6D41;&#x884C;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x5E93;&#x3002;<br>&#x6309;&#x7167;&#x5B98;&#x65B9;&#x7684;&#x4ECB;&#x7ECD;&#x5C31;&#x662F;</p>
<blockquote>
<p>A type-safe REST client for Android and Java</p>
</blockquote>
<p>&#x6CE8;&#x610F;&#xFF0C;Retrofit&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;==REST==&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x5E93;&#x3002;<br>&#x5728;&#x5B66;&#x4E60;Retrofit&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E86;&#x89E3;REST&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x5E93;&#x6700;&#x5927;&#x7684;&#x96BE;&#x70B9;&#xFF0C;&#x6211;&#x5927;&#x90E8;&#x5206;&#x65F6;&#x95F4;&#x4E5F;&#x90FD;&#x82B1;&#x5728;&#x8FD9;&#x4E2A;&#x90E8;&#x5206;&#x4E0A;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x4ECB;&#x7ECD;REST&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x3002;<br>REST&#x5168;&#x79F0;&#x4E3A;Representation State Transfer&#xFF0C;&#x7FFB;&#x8BD1;&#x8FC7;&#x6765;&#x5C31;&#x662F;&#x8868;&#x5F81;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x3002;<br>&#x5B83;&#x662F;&#x4E00;&#x79CD;&#x7279;&#x5B9A;&#x7684;&#x4E92;&#x8054;&#x7F51;&#x67B6;&#x6784;&#xFF0C;&#x7B26;&#x5408;&#x8FD9;&#x79CD;&#x67B6;&#x6784;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x79F0;&#x5B83;&#x4E3A;==<em>RESTful</em>==<br>&#x5149;&#x770B;&#x540D;&#x5B57;&#x975E;&#x5E38;&#x7684;&#x62BD;&#x8C61;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x7406;&#x89E3;REST&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x535A;&#x5BA2;&#x4E0A;&#x5BF9;&#x8FD9;&#x4E2A;&#x540D;&#x5B57;&#x7684;&#x89E3;&#x6790;&#x3002;&#x4E0B;&#x9762;&#x7528;&#x6211;&#x7684;&#x8BED;&#x8A00;&#x91CD;&#x65B0;&#x6765;&#x4ECB;&#x7ECD;&#x4E00;&#x904D;&#x4E0A;&#x9762;&#x51E0;&#x4E2A;&#x540D;&#x8BCD;&#x3002;</p>
<h4 id="Representation">Representation</h4><p>&#x8FD9;&#x4E2A;&#x8BCD;&#x662F;&#x6700;&#x4E0D;&#x597D;&#x7406;&#x89E3;&#x7684;&#xFF0C;&#x8981;&#x5F04;&#x61C2;&#x8FD9;&#x4E2A;&#x8BCD;&#x7684;&#x610F;&#x601D;&#xFF0C;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x8981;&#x5F04;&#x660E;&#x767D;Resource&#x7684;&#x6982;&#x5FF5;&#x3002;<br>Resource&#xFF0C;&#x5373;&#x8D44;&#x6E90;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x4F7F;&#x7528;&#x4E92;&#x8054;&#x7F51;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5728;&#x8BBF;&#x95EE;&#x4E92;&#x8054;&#x7F51;&#x4E0A;&#x7684;&#x4E00;&#x4E2A;&#x4E2A;&#x8D44;&#x6E90;&#x5E76;&#x7EC4;&#x7EC7;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x3002;&#x4E0D;&#x7BA1;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x8FD8;&#x662F;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x4E0A;&#x7F51;&#x9700;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x83B7;&#x53D6;&#x7279;&#x5B9A;&#x7684;&#x4FE1;&#x606F;&#x5E76;&#x663E;&#x793A;&#x4E3A;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x8981;&#x6C42;&#x7684;&#x5F62;&#x5F0F;&#x7ED9;&#x6211;&#x4EEC;&#x9605;&#x8BFB;&#x3002;<br>&#x5728;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x9996;&#x5148;&#x901A;&#x8FC7;URI&#xFF08;Uniform Resource Identifier&#xFF09;&#x5373;&#x552F;&#x4E00;&#x5B9A;&#x4F4D;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#x6765;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#xFF0C;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x5C31;&#x662F;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x5B58;&#x50A8;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x662F;&#x56FE;&#x7247;&#x3001;&#x89C6;&#x9891;&#x3001;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#xFF0C;&#x603B;&#x4E4B;&#x5C31;&#x662F;&#x4E00;&#x4E9B;&#x88AB;&#x4FDD;&#x5B58;&#x5728;&#x786C;&#x76D8;&#x91CC;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x8BBF;&#x95EE;&#x4E86;&#x5B83;&#x4EEC;&#x4E4B;&#x540E;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x6309;&#x7167;&#x89C4;&#x5B9A;&#x7684;&#x683C;&#x5F0F;&#x5C06;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x8FD4;&#x56DE;&#x7ED9;&#x8BBF;&#x95EE;&#x8005;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x8D44;&#x6E90;&#x7684;&#x8C03;&#x7528;&#x3002;<br>&#x90A3;&#x4E48;Representation&#x5728;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#x5462;&#xFF1F;<br>&#x5728;&#x6211;&#x4EEC;&#x4F7F;&#x7528;URI&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x6307;&#x5B9A;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x683C;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;URI&#x4EC5;&#x4EC5;&#x4EE3;&#x8868;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x8BBF;&#x95EE;&#x8DEF;&#x5F84;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x8DEF;&#x5F84;&#x4E0D;&#x5E94;&#x8BE5;&#x5305;&#x542B;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x5B83;&#x672C;&#x8EAB;&#x7684;&#x683C;&#x5F0F;&#x548C;&#x5185;&#x5BB9;&#xFF0C;&#x56E0;&#x6B64;Representation&#xFF08;&#x8868;&#x5F81;&#xFF09;&#x5373;&#x6307;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x8868;&#x793A;&#x5F62;&#x5F0F;&#x3002;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x53EF;&#x4EE5;&#x662F;JPG&#x3001;JSON&#x3001;XML&#x3001;HTML&#x3001;AVI&#x3002;</p>
<h4 id="State_Transfer">State Transfer</h4><p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x9605;&#x8BFB;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E86;&#x5728;&#x8BBF;&#x95EE;&#x8FC7;&#x7A0B;&#x4E2D;&#x6211;&#x4EEC;&#x4F7F;&#x7528;URI&#x4EC5;&#x4EC5;&#x53EA;&#x662F;&#x5F97;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x8F6C;&#x6362;&#x6210;Represtation&#x7684;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x5373;&#x4E3A;State Transfer&#xFF08;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#xFF09;&#x3002;&#x8FD9;&#x4E2A;&#x8F6C;&#x6362;&#x8FC7;&#x7A0B;&#x53D1;&#x751F;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x8FC7;HTTP&#x534F;&#x8BAE;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x53BB;&#x63A7;&#x5236;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;&#x8981;&#x6C42;&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<h3 id="&#x7EFC;&#x4E0A;&#x6240;&#x8BC9;">&#x7EFC;&#x4E0A;&#x6240;&#x8BC9;</h3><p>&#x6211;&#x76F4;&#x63A5;&#x5F15;&#x7528;&#x6211;&#x5B66;&#x4E60;&#x7684;&#x535A;&#x5BA2;&#x4E2D;&#x7684;&#x603B;&#x7ED3;&#xFF0C;&#x6211;&#x8BA4;&#x4E3A;&#x975E;&#x5E38;&#x7684;&#x7CBE;&#x70BC;&#x3002;</p>
<blockquote>
<p>&#x7EFC;&#x5408;&#x4E0A;&#x9762;&#x7684;&#x89E3;&#x91CA;&#xFF0C;&#x6211;&#x4EEC;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x4EC0;&#x4E48;&#x662F;RESTful&#x67B6;&#x6784;&#xFF1A;<br>&#x3000;&#x3000;&#xFF08;1&#xFF09;&#x6BCF;&#x4E00;&#x4E2A;URI&#x4EE3;&#x8868;&#x4E00;&#x79CD;&#x8D44;&#x6E90;&#xFF1B;<br>&#x3000;&#x3000;&#xFF08;2&#xFF09;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#xFF0C;&#x4F20;&#x9012;&#x8FD9;&#x79CD;&#x8D44;&#x6E90;&#x7684;&#x67D0;&#x79CD;&#x8868;&#x73B0;&#x5C42;&#xFF1B;<br>&#x3000;&#x3000;&#xFF08;3&#xFF09;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x8FC7;&#x56DB;&#x4E2A;HTTP&#x52A8;&#x8BCD;&#xFF0C;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x5B9E;&#x73B0;&#x201D;&#x8868;&#x73B0;&#x5C42;&#x72B6;&#x6001;&#x8F6C;&#x5316;&#x201D;&#x3002;</p>
</blockquote>
<h2 id="&#x4E8C;-How_Retrofit&#x7684;&#x4F7F;&#x7528;">&#x4E8C;.How &#x3000;Retrofit&#x7684;&#x4F7F;&#x7528;</h2><p>&#x7406;&#x89E3;&#x4E86;REST&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x53EF;&#x4EE5;&#x5B66;&#x4E60;Retrofit&#x7684;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x4E86;&#x3002;<br>&#x4F7F;&#x7528;&#x6B65;&#x9AA4;</p>
<h4 id="1-&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Retrofit&#x5B9E;&#x4F8B;">1.&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Retrofit&#x5B9E;&#x4F8B;</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">public</span> static final <span class="keyword">String </span><span class="keyword">BASE_URL </span>= <span class="string">&quot;http://api.myservice.com/&quot;</span><span class="comment">;</span></span><br><span class="line"><span class="label">Retrofit</span> retrofit = new Retrofit.<span class="keyword">Builder()</span><br><span class="line"></span>    .<span class="keyword">baseUrl(BASE_URL)</span><br><span class="line"></span>    .<span class="keyword">addConverterFactory(GsonConverterFactory.create())</span><br><span class="line"></span>    .<span class="keyword">build();</span></span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6839;&#x636E;REST&#x67B6;&#x6784;&#xFF0C;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x786E;&#x5B9A;&#x6211;&#x4EEC;&#x6240;&#x8BBF;&#x95EE;&#x7684;Api&#x7684;&#x8D44;&#x6E90;&#x57FA;&#x672C;URI&#xFF0C;&#x8FD9;&#x4E2A;URI&#x662F;&#x8FD9;&#x4E00;&#x6279;&#x63A5;&#x53E3;&#x7684;&#x516C;&#x5171;&#x524D;&#x7F00;&#x3002;<br>&#x6211;&#x4EEC;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x5177;&#x4F53;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;Api&#x90FD;&#x662F;BASE_URL/xxx/xxx&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x3002;<br>&#x63A5;&#x4E0B;&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Retrofit&#x5B9E;&#x4F8B;&#xFF0C;&#x5C06;&#x8FD9;&#x4E2A;BaseURL&#x4F20;&#x5165;&#xFF0C;&#x5E76;&#x6307;&#x5B9A;Retrofit&#x89E3;&#x6790;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x7684;&#x89E3;&#x6790;&#x5E93;&#xFF0C;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x54EA;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x5177;&#x4F53;&#x5206;&#x6790;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x518D;&#x53D9;&#x8FF0;&#x3002;</p>
<blockquote>
<p>&#x6709;&#x5982;&#x4E0B;&#x7684;&#x89E3;&#x6790;&#x5E93;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#xFF1A;<br>Converter    Library<br>Gson    com.squareup.retrofit:converter-gson:2.0.0-beta2<br>Jackson    com.squareup.retrofit:converter-jackson:2.0.0-beta1<br>Moshi    com.squareup.retrofit:converter-moshi:2.0.0-beta1<br>Protobuf    com.squareup.retrofit:converter-protobuf:2.0.0-beta1<br>Wire    com.squareup.retrofit:converter-wire:2.0.0-beta1<br>Simple XML    com.squareup.retrofit:converter-simplexml:2.0.0-beta1</p>
</blockquote>
<p>&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x8981;&#x6C42;&#x7684;retrofit&#x5B9E;&#x4F8B;&#x4E86;&#x3002;</p>
<h4 id="2-&#x6839;&#x636E;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x63A5;&#x53E3;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x7684;&#x683C;&#x5F0F;&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;">2.&#x6839;&#x636E;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x63A5;&#x53E3;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x7684;&#x683C;&#x5F0F;&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;</h4><p>&#x8FD9;&#x91CC;&#x6211;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x4E00;&#x6B3E;Android Studio&#x63D2;&#x4EF6;GsonFormat&#xFF0C;&#x6839;&#x636E;&#x5B57;&#x7B26;&#x4E32;&#x4E00;&#x952E;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#x3002;</p>
<h4 id="3-&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;&#x63A5;&#x53E3;">3.&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;&#x63A5;&#x53E3;</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">public</span> <span class="tag">interface</span> <span class="tag">ApiInterface</span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">@GET</span>(<span class="string">&quot;users/{username}&quot;</span>)</span><br><span class="line">Call&lt;User&gt; <span class="function">getUser</span>(<span class="variable">@Path</span>(<span class="string">&quot;username&quot;</span>) String username);</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;Retrofit&#x63A5;&#x53E3;&#x4E00;&#x5171;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x4E24;&#x6837;&#x4E1C;&#x897F;&#x3002;<br>(1)&#x6307;&#x5B9A;HTTP&#x7684;&#x52A8;&#x4F5C;<br>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x7684;&#x53C2;&#x6570;&#x6709;&#x56DB;&#x4E2A;&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#xFF1A;<br>GET<br>POST<br>PUT<br>DELETE<br>&#x4E0D;&#x6E05;&#x695A;&#x8FD9;&#x51E0;&#x4E2A;&#x52A8;&#x4F5C;&#x5728;HTTP&#x4E2D;&#x7684;&#x5177;&#x4F53;&#x7684;&#x542B;&#x4E49;&#x7684;&#x540C;&#x5B66;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x767E;&#x5EA6;&#x518D;&#x4ED4;&#x7EC6;&#x7814;&#x7A76;&#x3002;<br>&#x8FD9;&#x91CC;&#x6211;&#x63A8;&#x8350;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#xFF1A;<br><a href="get,put,post,delete&#x542B;&#x4E49;&#x4E0E;&#x533A;&#x522B;">http://286.iteye.com/blog/1420713</a><br>&#x5728;&#x540E;&#x9762;&#x7684;&#x53C2;&#x6570;&#x4E3A;BASE_URL&#x540E;&#x53E6;&#x52A0;&#x5165;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x4ECE;&#x800C;&#x6307;&#x5B9A;&#x6211;&#x4EEC;&#x8981;&#x8C03;&#x7528;&#x7684;Api&#x7684;URL&#x3002;<br><em>&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x5751;&#xFF01;</em><br>BaseURL&#x548C;@GET&#x540E;&#x7684;&#x9644;&#x52A0;&#x7684;URL&#x7684;&#x95EE;&#x9898;&#x3002;<br>&#x6211;&#x4F7F;&#x7528;&#x7684;retrofit2.0&#x5728;BaseURL&#x540E;&#x7684;URL&#x5FC5;&#x987B;&#x4EE5;/&#x7ED3;&#x5C3E;&#xFF01;&#xFF01;<br>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http:</span><span class="comment">//api.myservice.com/</span></span><br><span class="line"><span class="string">http:</span><span class="comment">//api.myservice.com</span></span><br></pre></td></tr></table></figure>
<p>&#x662F;&#x4E0D;&#x540C;&#x7684;&#xFF01;&#x8FD9;&#x4E2A;/&#x4F60;&#x4E0D;&#x80FD;&#x63A5;&#x5728;@GET&#x4E2D;&#x7684;URL&#x7684;&#x9644;&#x52A0;&#x4E2D;&#xFF0C;retrofit&#x5BF9;&#x8FD9;&#x4E00;&#x70B9;&#x6709;&#x7EDD;&#x5BF9;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x50CF;&#x540E;&#x9762;&#x4E00;&#x6837;&#xFF0C;&#x4F60;&#x5C31;&#x4F1A;&#x6210;&#x529F;&#x63A5;&#x6536;&#x5230;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x662F;&#x72C2;&#x62A5;404..&#x8BF7;&#x8BB0;&#x4F4F;&#x8FD9;&#x70B9;<br>(2)&#x521B;&#x5EFA;&#x5728;Api&#x8C03;&#x7528;&#x5B8C;&#x6210;&#x540E;&#x88AB;&#x56DE;&#x8C03;&#x7684;&#x51FD;&#x6570;&#x3002;<br>&#x5728;Retrofit2.0&#x4E4B;&#x524D;&#x8FD9;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x662F;&#x53EF;&#x4EE5;&#x6709;&#x4E24;&#x79CD;&#x5B9A;&#x4E49;&#x6A21;&#x5F0F;&#x7684;&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#x540C;&#x6B65;&#x4E0E;&#x5F02;&#x6B65;&#xFF0C;&#x4F46;&#x662F;&#x5728;2.0&#x5220;&#x9664;&#x4E86;&#x540C;&#x6B65;&#x7684;&#x5199;&#x6CD5;&#xFF0C;&#x76EE;&#x524D;&#x53EA;&#x6709;&#x4E00;&#x79CD;&#x5F02;&#x6B65;&#x7684;&#x5B9A;&#x4E49;&#x65B9;&#x5F0F;&#x3002;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">Call</span>&lt;<span class="keyword">User</span>&gt; getUser(@<span class="keyword">Path</span>(<span class="string">&quot;username&quot;</span>) <span class="keyword">String</span> username);</span></span><br></pre></td></tr></table></figure>
<p>Call&#x7684;&#x6CDB;&#x578B;&#x4E2D;&#x7684;&#x7C7B;&#x578B;&#x5373;&#x4E3A;&#x5B8C;&#x6210;&#x8C03;&#x7528;&#x540E;&#x89E3;&#x6790;&#x5F97;&#x5230;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#x7684;&#x7C7B;&#x578B;&#x3002;<br>&#x5728;&#x65B9;&#x6CD5;&#x4E2D;&#x540C;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7279;&#x6B8A;&#x7684;&#x6CE8;&#x89E3;&#x3002;<br>&#x8FD9;&#x91CC;&#x6709;&#x51E0;&#x79CD;&#x7279;&#x6B8A;&#x7684;&#x6CE8;&#x89E3;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x9009;&#x62E9;</p>
<blockquote>
<p>@Path<br>&#x4F7F;&#x7528;@Path&#x6CE8;&#x89E3;&#x53EF;&#x4EE5;&#x5C06;URL&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#x66FF;&#x6362;&#x4E3A;&#x6CE8;&#x5B9A;&#x7684;&#x503C;&#x3002;<br>@Query<br>&#x4F7F;&#x7528;@Query&#x6CE8;&#x89E3;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x67E5;&#x8BE2;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x6CE8;&#x89E3;&#x7ED3;&#x5408;POST&#x4F7F;&#x7528;&#x3002;<br>@Body<br>&#x4F7F;&#x7528;@Body&#x6CE8;&#x89E3;&#x53EF;&#x4EE5;&#x5C06;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x76F4;&#x63A5;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#x3002;<br>&#x5269;&#x4E0B;&#x7684;&#x6CE8;&#x89E3;&#x53EF;&#x4EE5;&#x5728;&#x4F7F;&#x7528;&#x65F6;&#x518D;&#x5177;&#x4F53;&#x67E5;&#x8BE2;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x5BF9;&#x6211;&#x8BA4;&#x4E3A;&#x4E0D;&#x592A;&#x91CD;&#x8981;&#x7684;&#x6CE8;&#x89E3;&#x4E0D;&#x518D;&#x4ECB;&#x7ECD;&#x3002;<br>(3)&#x6267;&#x884C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x7684;call&#x3002;<br>&#x5982;&#x679C;&#x60F3;&#x8981;&#x5728;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6267;&#x884C;call&#x3002;<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">call</span>.<span class="keyword">execute</span>();</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x5373;&#x53EF;&#x3002;<br>&#x5982;&#x679C;&#x60F3;&#x8981;&#x5728;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x65B0;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;enqueue<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call.<span class="function"><span class="title">enqueue</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></p>
<p>&#x4F7F;&#x7528;&#x4EE4;call&#x5165;&#x961F;&#x7B49;&#x5F85;&#x6267;&#x884C;&#x3002;<br>&#x6CE8;&#x610F;&#x6BCF;&#x4E00;&#x4E2A;Call&#x4EC5;&#x80FD;&#x6267;&#x884C;&#x4E00;&#x6B21;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8981;&#x518D;&#x6B21;&#x6267;&#x884C;&#x8FD9;&#x4E2A;Call&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x518D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;Call&#xFF0C;&#x5B98;&#x65B9;&#x5F53;&#x7136;&#x7ED9;&#x4E86;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;&#x4F7F;&#x7528;call.clone()&#x5373;&#x53EF;&#x590D;&#x5236;&#x4E00;&#x4E2A;&#x5B8C;&#x5168;&#x4E00;&#x6837;&#x7684;Call&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x9644;&#x4E0A;&#x6211;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x5B9E;&#x4F8B;&#x3002;</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder<span class="params">()</span></span><br><span class="line">                        .baseUrl<span class="params">(ApiConfig.ZHIHU_BASE)</span></span><br><span class="line">                        .addConverterFactory<span class="params">(GsonConverterFactory.create<span class="params">()</span>)</span></span><br><span class="line">                        .build<span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">StartImageInterface startImageInterface= retrofit.create<span class="params">(StartImageInterface.class)</span>;</span><br><span class="line"></span><br><span class="line">retrofit.Call&lt;StartGsonBean&gt; beanCall = startImageInterface.startImage<span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">beanCall.enqueue<span class="params">(new retrofit.Callback&lt;StartGsonBean&gt;<span class="params">()</span> {</span><br><span class="line">    @Override</span><br><span class="line">    public void onResponse<span class="params">(retrofit.Response&lt;StartGsonBean&gt; response, Retrofit retrofit)</span> {</span><br><span class="line">            Log.d<span class="params">(<span class="string">&quot;TAG&quot;</span>,response.body<span class="params">()</span>.getImg<span class="params">()</span>)</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onFailure<span class="params">(Throwable t)</span> {</span><br><span class="line">        t.printStackTrace<span class="params">()</span>;</span><br><span class="line">    }</span><br><span class="line">})</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StartImageInterface</span> </span>{</span><br><span class="line">    <span class="annotation">@GET</span>(ApiConfig.START_IMAGE)</span><br><span class="line">    <span class="function">Call&lt;StartGsonBean&gt; <span class="title">startImage</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x597D;&#x4E86;&#xFF0C;Retrofit&#x4F7F;&#x7528;&#x7684;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;&#x5230;&#x8FD9;&#x91CC;&#x5C31;&#x7ED3;&#x675F;&#x4E86;&#x3002;</p>
<p>##&#x4E09;.Why Retrofit&#x5B9E;&#x73B0;&#x7684;&#x539F;&#x7406;<br>&#x8FD9;&#x4E00;&#x5757;&#x5185;&#x5BB9;&#x8FD8;&#x662F;&#x7B49;&#x6211;&#x6C34;&#x5E73;&#x8DB3;&#x591F;&#x518D;&#x4ED4;&#x7EC6;&#x7814;&#x7A76;&#x3002;&#x3002;</p>
<p>##&#x56DB;.&#x5176;&#x5B83;<br>&#x5982;&#x679C;&#x8981;&#x5B66;&#x4E60;Retrofit&#xFF0C;&#x8BF7;&#x5728;&#x5B98;&#x65B9;&#x5904;&#x4E0B;&#x8F7D;&#x5F53;&#x524D;&#x6700;&#x65B0;&#x7684;2.0&#xFF0C;&#x800C;&#x4E14;&#x6CE8;&#x610F;&#xFF0C;2.0&#x4E0E;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#x6709;&#x8F83;&#x5927;&#x5DEE;&#x5F02;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x67E5;&#x8BE2;&#x76F8;&#x5173;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8BF7;&#x8BB0;&#x5F97;&#x6CE8;&#x610F;Retrofit&#x7684;&#x7248;&#x672C;&#x95EE;&#x9898;&#xFF0C;&#x6709;&#x4E0D;&#x5C11;&#x7814;&#x7A76;Retrofit&#x7684;&#x6587;&#x7AE0;&#x5DF2;&#x7ECF;&#x8FC7;&#x65F6;&#x4E86;&#x3002;</p>
<p>&#x4F7F;&#x7528;Retrofit+Okhttp&#xFF0C;&#x5B8C;&#x7F8E;&#x89E3;&#x51B3;&#x7F51;&#x7EDC;&#x8C03;&#x7528;&#x95EE;&#x9898;&#x3002;<br>&#x6CE8;&#x610F;&#xFF0C;Retrofit&#x53EA;&#x6709;&#x5728;Api&#x7B26;&#x5408;REST&#x89C4;&#x8303;&#xFF0C;&#x5373;&#x5B83;&#x662F;RESTful&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x624D;&#x8DB3;&#x591F;&#x7684;&#x65B9;&#x4FBF;&#x3002;&#x5982;&#x679C;&#x78B0;&#x4E0A;&#x4E00;&#x4E9B;&#x4E2A;&#x522B;&#x7684;&#x5947;&#x8469;Api&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Okhttp&#x6765;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;Okhttp&#x662F;Squre&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x901A;&#x8BAF;&#x5E93;&#xFF0C;&#x800C;&#x4E14;Retrofit&#x7684;&#x5E95;&#x5C42;&#x4E5F;&#x6B63;&#x662F;&#x57FA;&#x4E8E;Okhttp&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x8BF4;&#xFF0C;Retrofit&#x5C31;&#x662F;&#x4EE5;Okhttp&#x4E3A;&#x9AA8;&#x67B6;&#xFF0C;&#x5C01;&#x88C5;&#x4E86;&#x4E00;&#x4E9B;&#x53E6;&#x5916;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4ECE;&#x800C;&#x65B9;&#x4FBF;&#x6211;&#x4EEC;&#x8C03;&#x7528;RESTful&#x7684;&#x4E13;&#x7528;&#x5E93;&#x3002;&#x56E0;&#x6B64;Okhttp&#x7684;&#x7528;&#x6CD5;&#x4E0E;Retrofit&#x51E0;&#x4E4E;&#x76F8;&#x540C;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x65F6;&#x4E5F;&#x4E0D;&#x7528;&#x8003;&#x8651;&#x4EC0;&#x4E48;&#x517C;&#x5BB9;&#x95EE;&#x9898;&#xFF0C;&#x653E;&#x5FC3;&#x5927;&#x80C6;&#x7684;&#x4F7F;&#x7528;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF01;</p>
<p>Retrofit&#x5B98;&#x65B9;&#x7F51;&#x7AD9;</p>
<p><a href="http://square.github.io/retrofit/#introduction" target="_blank" rel="external">Retrofit</a></p>
<p>OkHttp&#x5B98;&#x65B9;&#x7F51;&#x7AD9;<br><a href="http://square.github.io/okhttp/" target="_blank" rel="external">OkHttp</a><br>&#x53C2;&#x8003;&#x535A;&#x5BA2;<br><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0915/3460.html" target="_blank" rel="external">Retrofit 2.0&#xFF1A;&#x6709;&#x53F2;&#x4EE5;&#x6765;&#x6700;&#x5927;&#x7684;&#x6539;&#x8FDB;</a><br><a href="http://www.ruanyifeng.com/blog/2011/09/restful.html" target="_blank" rel="external">&#x7406;&#x89E3;RESTful&#x67B6;&#x6784;</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-rxJava详解" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/13/rxJava详解/" class="article-date">
  	<time datetime="2015-12-13T10:43:47.000Z" itemprop="datePublished">2015-12-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/13/rxJava详解/">rxJava详解</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#x8FD9;&#x4E2A;&#x5468;&#x516D;&#x4E00;&#x6574;&#x5929;&#x90FD;&#x5728;&#x5B66;&#x4E60;rxJava&#xFF0C;&#x53C8;&#x6DA8;&#x4E86;&#x4E0D;&#x5C11;&#x59FF;&#x52BF;&#x3002;</p>
<h2 id="&#x4E00;-What?_rxJava&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x5B83;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#xFF0C;&#x6709;&#x4EC0;&#x4E48;&#x4F18;&#x70B9;">&#x4E00;.What?&#x3000;rxJava&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x5B83;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#xFF0C;&#x6709;&#x4EC0;&#x4E48;&#x4F18;&#x70B9;</h2><p>rxJava&#x662F;&#x4E00;&#x5957;&#x51FD;&#x6570;&#x54CD;&#x5E94;&#x5F0F;Java&#x7F16;&#x7A0B;&#x6846;&#x67B6;&#x3002;&#x6574;&#x5957;&#x7ED3;&#x6784;&#x57FA;&#x4E8E;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x89E3;&#x51B3;&#x6211;&#x4EEC;&#x5934;&#x75BC;&#x7684;&#x5F02;&#x6B65;&#x95EE;&#x9898;&#xFF0C;&#x7ED3;&#x5408;rxAndroid&#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x629B;&#x5F03;Android&#x539F;&#x751F;&#x7684;AsyncTask&#x3002;&#x5176;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x65B9;&#x5F0F;&#x8BA9;&#x6574;&#x4E2A;&#x601D;&#x7EF4;&#x8FC7;&#x7A0B;&#x53D8;&#x5F97;&#x6E05;&#x6670;&#x6D41;&#x7545;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x7740;&#x91CD;&#x4ECB;&#x7ECD;rxJava&#x7684;&#x4F18;&#x70B9;&#xFF1A;<br>1.<strong>&#x4E00;&#x5957;&#x5B8C;&#x6574;&#x7684;&#x5F02;&#x6B65;&#x89E3;&#x51B3;&#x65B9;&#x6848;</strong>&#x3002;<br>&#x4E0E;AsyncTask&#x76F8;&#x6BD4;&#x66F4;&#x52A0;&#x4F18;&#x96C5;&#xFF0C;&#x800C;&#x4E14;&#x652F;&#x6301;&#x7684;&#x529F;&#x80FD;&#x66F4;&#x52A0;&#x5F3A;&#x5927;&#x3002;&#x66F4;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x7531;&#x4E8E;Acitivty&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x5F71;&#x54CD;&#xFF0C;AsyncTask&#x5B58;&#x5728;&#x6781;&#x5927;&#x7684;&#x9690;&#x60A3;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x4F7F;&#x7528;AsyncTask&#x65F6;&#x901A;&#x5E38;&#x4EE5;&#x5185;&#x90E8;&#x7C7B;&#x7684;&#x5F62;&#x5F0F;&#x5D4C;&#x5165;Activity&#x4E2D;&#xFF0C;&#x56E0;&#x4E3A;AsyncTask&#x9690;&#x5F0F;&#x6301;&#x6709;Activity&#x7684;&#x5F15;&#x7528;&#xFF0C;<strong>&#x4F46;&#x662F;AsyncTask&#x5982;&#x679C;&#x4E0D;&#x88AB;cancel&#x6216;&#x8005;&#x5C06;&#x5176;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#xFF0C;&#x5B83;&#x5C31;&#x4E0D;&#x4F1A;&#x88AB;&#x56DE;&#x6536;</strong>&#xFF0C;&#x56E0;&#x4E3A;&#x4E24;&#x8005;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E0D;&#x540C;&#x6B65;&#xFF0C;&#x5F53;&#x6267;&#x884C;&#x8017;&#x65F6;&#x4EFB;&#x52A1;&#x6216;&#x8005;&#x624B;&#x673A;&#x5C4F;&#x5E55;&#x65CB;&#x8F6C;&#x5BFC;&#x81F4;Activity&#x88AB;&#x9500;&#x6BC1;&#x65F6;&#x6781;&#x6709;&#x53EF;&#x80FD;&#x9020;&#x6210;&#x5185;&#x5B58;&#x6CC4;&#x9732;&#xFF01;&#x4F7F;&#x7528;rxJava&#x548C;rxAndroid&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<p>2.<strong>&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x3002;</strong><br>rxJava&#x6574;&#x4E2A;&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#x662F;&#x6CA1;&#x6709;&#x7EC4;&#x5408;&#x5D4C;&#x5957;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x5B83;&#x4E0D;&#x4F1A;&#x9020;&#x6210;&#x591A;&#x4F59;&#x7684;&#x8026;&#x5408;&#xFF0C;&#x800C;&#x4E14;&#x5176;&#x8FC7;&#x7A0B;&#x975E;&#x5E38;&#x6E05;&#x6670;&#xFF0C;&#x751A;&#x81F3;&#x4E0D;&#x9700;&#x8981;&#x5F88;&#x590D;&#x6742;&#x7684;&#x6CE8;&#x91CA;&#x5C31;&#x80FD;&#x8BFB;&#x61C2;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x7684;&#x903B;&#x8F91;&#x3002;<br>&#x5B83;&#x7684;&#x8C03;&#x7528;&#x8FC7;&#x7A0B;&#x5927;&#x6982;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.map(fun)
.subscribeOn(thread)
.observeOn(thread)
.suscribe(new  Action{
    public void call(params){
    }
  } )</span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6574;&#x4E2A;&#x8C03;&#x7528;&#x8FC7;&#x7A0B;&#x7684;&#x903B;&#x8F91;&#x662F;&#x975E;&#x5E38;&#x6E05;&#x6670;&#x7684;&#x3002;</p>
<p>3.<strong>&#x5F3A;&#x5927;&#x7684;map&#x548C;filter&#x529F;&#x80FD;&#x3002;</strong><br>rxJava&#x5F15;&#x5165;&#x4E86;&#x5F88;&#x591A;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x6070;&#x5DE7;&#x6211;&#x6700;&#x8FD1;&#x6B63;&#x5728;&#x770B;&#x300A;&#x8BA1;&#x7B97;&#x673A;&#x7A0B;&#x5E8F;&#x7684;&#x6784;&#x9020;&#x4E0E;&#x89E3;&#x91CA;&#x300B;&#xFF0C;&#x5B66;&#x4E60;&#x4E86;&#x4E00;&#x4E9B;List&#x7684;&#x65B9;&#x8A00;Scheme&#x7684;&#x8BED;&#x6CD5;&#x77E5;&#x8BC6;&#xFF0C;&#x7B80;&#x5355;&#x4E86;&#x89E3;&#x4E86;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x601D;&#x60F3;&#x3002;rxJava&#x5F15;&#x5165;&#x7684;map&#x548C;filter&#x5C31;&#x662F;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x4E2D;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x6982;&#x5FF5;&#xFF0C;map&#x662F;&#x4E00;&#x79CD;&#x6620;&#x5C04;&#x53D8;&#x6362;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x901A;&#x8FC7;map&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x4E00;&#x79CD;Observable&#x53D8;&#x6362;&#x6210;&#x53E6;&#x4E00;&#x79CD;Observable&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x95ED;&#x5305;&#x7684;&#x6027;&#x8D28;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;map&#x5F97;&#x5230;&#x4EFB;&#x4F55;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;Observable&#xFF0C;&#x5728;Android&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x7684;&#x76F4;&#x63A5;&#x4F53;&#x73B0;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x4F20;&#x5165;Observable&#x7684;&#x53C2;&#x6570;&#x8F6C;&#x5316;&#x4E3A;&#x4EFB;&#x610F;&#x7684;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF01;<br>&#x6BD4;&#x5982;&#x6211;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Observable.just<span class="params">(faceBitmap)</span></span><br><span class="line">          .map<span class="params">(new Func1&lt;Bitmap, DetectFaceInteractor&gt;<span class="params">()</span> {</span><br><span class="line">                    @Override</span><br><span class="line">                    public DetectFaceInteractor call<span class="params">(Bitmap bitmap)</span> {</span><br><span class="line">                        JSONObject respsonse = null;</span><br><span class="line">                        try {</span><br><span class="line">                            respsonse = youtu.FaceShape<span class="params">(faceBitmap, <span class="number">0</span>)</span>;</span><br><span class="line">                            FacePositionModel model = gson.fromJson<span class="params">(respsonse.toString<span class="params">()</span>, FacePositionModel.class)</span>;</span><br><span class="line">                            detectFaceInteractor = new DetectFaceInteractorImpl<span class="params">(model, BitmapRich.toGrayscale<span class="params">(faceBitmap)</span>)</span>;</span><br><span class="line">                        } catch <span class="params">(IOException e)</span> {</span><br><span class="line">                            e.printStackTrace<span class="params">()</span>;</span><br><span class="line">                        } catch <span class="params">(JSONException e)</span> {</span><br><span class="line">                            e.printStackTrace<span class="params">()</span>;</span><br><span class="line">                        } catch <span class="params">(KeyManagementException e)</span> {</span><br><span class="line">                            e.printStackTrace<span class="params">()</span>;</span><br><span class="line">                        } catch <span class="params">(NoSuchAlgorithmException e)</span> {</span><br><span class="line">                            e.printStackTrace<span class="params">()</span>;</span><br><span class="line">                        }</span><br><span class="line">                        return detectFaceInteractor;</span><br><span class="line">                    }</span><br><span class="line">                })</span></span><br></pre></td></tr></table></figure>
<p>&#x901A;&#x8FC7;map&#x6211;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x53D8;&#x6362;&#xFF1A;<br>&#x5C06;&#x4F20;&#x5165;&#x7684;bitmap&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x63A5;&#x53E3;&#x5F97;&#x5230;Json&#x683C;&#x5F0F;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;Gson&#x89E3;&#x6790;&#x6210;&#x4E00;&#x4E2A;JavaBean&#xFF0C;&#x6700;&#x540E;&#x4F20;&#x5165;Interactor&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x4E1A;&#x52A1;&#x7C7B;&#xFF01;<br>&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;map&#x7684;&#x53C2;&#x6570;&#x4E00;&#x4E2A;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;fun&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x9700;&#x8981;&#x7684;&#x4EC5;&#x4EC5;&#x662F;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x53D8;&#x6362;&#x8FC7;&#x7A0B;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;Java&#x662F;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x8FEB;&#x4E0D;&#x5F97;&#x5DF2;&#x4F7F;&#x7528;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x6765;&#x5B9E;&#x73B0;&#x8FD9;&#x79CD;&#x4EC5;&#x6709;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x8D77;&#x4F5C;&#x7528;&#x7684;&#x7C7B;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4E0E;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x5728;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x4E2D;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x628A;&#x4E00;&#x4E2A;&#x51FD;&#x6570;A&#x5F53;&#x505A;&#x53C2;&#x6570;&#x4F20;&#x5165;&#x53E6;&#x4E00;&#x4E2A;&#x51FD;&#x6570;B&#xFF0C;&#x51FD;&#x6570;B&#x5C31;&#x53EB;&#x505A;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x5728;Java8&#x4E2D;&#x5DF2;&#x7ECF;&#x901A;&#x8FC7;lambda&#x8868;&#x8FBE;&#x5F0F;&#x5F15;&#x5165;&#x4E86;Java&#x4E2D;&#xFF0C;&#x4E4B;&#x6240;&#x4EE5;&#x79F0;rxJava&#x4E3A;&#x51FD;&#x6570;&#x5F0F;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x4E5F;&#x662F;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x539F;&#x56E0;&#xFF0C;&#x5B83;&#x5176;&#x4E2D;&#x5F15;&#x5165;&#x4E86;&#x5F88;&#x591A;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x56E0;&#x6B64;&#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;rxJava&#xFF0C;&#x914D;&#x5408;lambda&#x8868;&#x8FBE;&#x5F0F;&#x4F1A;&#x628A;&#x4F60;&#x7684;&#x4EE3;&#x7801;&#x7B80;&#x5316;&#x5230;&#x6781;&#x81F4;&#xFF01;</p>
<h2 id="&#x4E8C;-How&#xFF1F;_rxjava&#x600E;&#x4E48;&#x4F7F;&#x7528;">&#x4E8C;.How&#xFF1F;&#x3000;rxjava&#x600E;&#x4E48;&#x4F7F;&#x7528;</h2><p>&#x8981;&#x5B66;&#x4F1A;&#x5982;&#x4F55;&#x4F7F;&#x7528;rxJava&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5F04;&#x660E;&#x767D;&#x4E09;&#x5757;&#x5185;&#x5BB9;</p>
<p>1.<strong>&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x3002;</strong><br>rxJava&#x7684;&#x6574;&#x4E2A;&#x67B6;&#x6784;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x7406;&#x89E3;&#x8FD9;&#x79CD;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x5728;&#x4F7F;&#x7528;&#x65F6;&#x4F60;&#x5C06;&#x5BF8;&#x6B65;&#x96BE;&#x884C;&#x3002;<br>&#x4EC0;&#x4E48;&#x662F;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#xFF1F;<br>&#x5728;Java&#x4F7F;&#x7528;&#x65F6;&#x4F60;&#x6709;&#x6CA1;&#x6709;&#x53D1;&#x73B0;&#x5728;&#x5F88;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x53D8;&#x5316;&#x4F9D;&#x8D56;&#x4E8E;&#x53E6;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x8FD9;&#x79CD;&#x901A;&#x7528;&#x7684;&#x60C5;&#x51B5;&#x62BD;&#x51FA;&#x6765;&#x8FDB;&#x884C;&#x603B;&#x7ED3;&#xFF0C;&#x5C06;&#x5176;&#x79F0;&#x4E4B;&#x4E3A;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x3002;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x89C2;&#x5BDF;&#x8005;&#x548C;&#x4E00;&#x4E2A;&#x88AB;&#x89C2;&#x5BDF;&#x8005;&#xFF0C;&#x5F53;&#x88AB;&#x89C2;&#x5BDF;&#x8005;&#x5BF9;&#x8C61;&#x53D1;&#x73B0;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x5B83;&#x5C06;&#x901A;&#x77E5;&#x4E0E;&#x5B83;&#x5173;&#x8054;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#xFF0C;&#x8FD9;&#x65F6;&#x89C2;&#x5BDF;&#x8005;&#x5C31;&#x5C06;&#x505A;&#x51FA;&#x76F8;&#x5E94;&#x7684;&#x5E94;&#x5BF9;&#x3002;<br>&#x7B80;&#x5355;&#x7684;&#x6765;&#x8BF4;&#xFF0C;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x5C31;&#x662F;</p>
<figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="component">Observable.onChange(){</span><br><span class="line"> observer<span class="string">.changeWithIt</span>;</span><br><span class="line">}</span></span><br></pre></td></tr></table></figure>
<p>&#x5177;&#x4F53;&#x7684;&#x5C31;&#x4E0D;&#x518D;&#x5C55;&#x5F00;&#x3002;</p>
<p>2.<strong>rxJava&#x7684;&#x91CD;&#x8981;&#x7C7B;&#x548C;&#x63A5;&#x53E3;</strong><br>rxJava&#x4E2D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x51E0;&#x4E2A;&#x63A5;&#x53E3;&#x548C;&#x7C7B;&#x7684;&#x5173;&#x7CFB;&#x7406;&#x6E05;&#x695A;&#x65F6;&#x4F60;&#x5C31;&#x5C06;&#x660E;&#x767D;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x3002;<br>&#xFF08;1&#xFF09;Observable&#x7C7B; &#x88AB;&#x89C2;&#x5BDF;&#x8005;<br>&#xFF08;2&#xFF09;Observer&#x63A5;&#x53E3;  &#x89C2;&#x5BDF;&#x8005;<br>&#xFF08;3&#xFF09;Subscribe&#x7C7B;   &#x8BA2;&#x9605;&#x8005;&#xFF0C;&#x6CE8;&#x610F;&#x8FD9;&#x4E2A;&#x7C7B;&#x662F;Observable&#x7C7B;&#x7684;&#x5B50;<br>&#x7C7B;&#xFF0C;&#x540C;&#x65F6;&#x53C8;&#x662F;Observer&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x3002;&#x8FD9;&#x70B9;&#x53EF;&#x80FD;&#x6709;&#x4E9B;&#x5947;&#x602A;&#xFF0C;&#x6211;&#x4EEC;&#x6682;&#x4E14;&#x4E0D;&#x53BB;&#x6DF1;&#x7A76;&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x7684;&#x610F;&#x4E49;&#x3002;<br>&#xFF08;4&#xFF09;Function&#x63A5;&#x53E3;  &#x5B9E;&#x73B0;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x51FD;&#x6570;&#x53C2;&#x6570;<br>&#xFF08;5&#xFF09;Action&#x63A5;&#x53E3;       Function&#x7684;&#x5B50;&#x63A5;&#x53E3;&#xFF0C;&#x8D77;&#x5230;&#x7B80;&#x5316;&#x4F7F;&#x7528;&#x7684;&#x4F5C;&#x7528;<br>&#x7531;&#x540D;&#x5B57;&#x5C31;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x524D;&#x51E0;&#x4E2A;&#x5173;&#x952E;&#x7C7B;&#x5728;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x5BF9;&#x5E94;&#x7684;&#x5730;&#x4F4D;&#x3002;&#x540E;&#x9762;&#x4E24;&#x4E2A;&#x63A5;&#x53E3;&#x5728;&#x4F7F;&#x7528;&#x65F6;&#x518D;&#x4ED4;&#x7EC6;&#x7814;&#x7A76;&#x3002;<br>&#x6682;&#x4E14;&#x5C31;&#x5230;&#x8FD9;&#x91CC;&#x3002;</p>
<p>3.<strong>&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x601D;&#x60F3;</strong><br>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x63A5;&#x89E6;&#x8FC7;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#xFF0C;&#x76F4;&#x63A5;&#x5B66;&#x4E60;rxJava&#x4F1A;&#x975E;&#x5E38;&#x96BE;&#x4EE5;&#x9002;&#x5E94;&#x5176;&#x4E2D;&#x5927;&#x91CF;&#x7684;&#x964C;&#x751F;&#x6982;&#x5FF5;&#x3002;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x8BF4;&#x660E;&#x51E0;&#x4E2A;&#x6211;&#x76EE;&#x524D;&#x63A5;&#x89E6;&#x5230;&#x7684;&#x76F8;&#x5173;&#x6982;&#x5FF5;&#x3002;<br>&#xFF08;1&#xFF09;&#x9AD8;&#x9636;&#x51FD;&#x6570;<br>    &#x4EE5;&#x51FD;&#x6570;&#x4E3A;&#x53C2;&#x6570;&#x7684;&#x51FD;&#x6570;&#x88AB;&#x79F0;&#x4E3A;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#xFF0C;&#x5728;Java&#x4E2D;&#x6CA1;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x6765;&#x66FF;&#x4EE3;&#x51FD;&#x6570;&#x4F20;&#x5165;&#xFF0C;&#x8FD9;&#x8BA9;Java&#x4EE3;&#x7801;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x81C3;&#x80BF;&#xFF0C;&#x5728;Java8&#x4E2D;&#x5F15;&#x5165;lambda&#x8868;&#x8FBE;&#x5F0F;&#x5C31;&#x662F;&#x5B9E;&#x73B0;&#x4E86;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#xFF0C;&#x60F3;&#x8981;&#x6DF1;&#x5165;&#x5B66;&#x4E60;&#x7684;&#x540C;&#x5B66;&#x53EF;&#x4EE5;&#x518D;&#x6DF1;&#x5165;&#x7684;&#x53BB;&#x780D;&#x4E00;&#x4E0B;lambda&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x76F8;&#x5173;&#x5185;&#x5BB9;&#x3002;<br>&#xFF08;2&#xFF09;&#x95ED;&#x5305;&#x6620;&#x5C04;<br>&#x5F53;&#x4E00;&#x4E2A;&#x7ED3;&#x6784;&#x6EE1;&#x8DB3;&#x95ED;&#x5305;&#x6027;&#x8D28;&#x65F6;&#xFF0C;&#x5373;&#x5BF9;&#x5B83;&#x8FDB;&#x884C;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x64CD;&#x4F5C;&#x8FD4;&#x56DE;&#x7684;&#x90FD;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x76F8;&#x5E94;&#x7684;&#x7ED3;&#x6784;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x4EE5;&#x6B64;&#x4E3A;&#x57FA;&#x7840;&#x6784;&#x5EFA;&#x66F4;&#x5927;&#x66F4;&#x62BD;&#x8C61;&#x7684;&#x7ED3;&#x6784;&#x3002;&#x8FD9;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5C01;&#x88C5;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x5728;Java&#x4E2D;&#x76F4;&#x63A5;&#x7684;&#x4F53;&#x73B0;&#x5C31;&#x662F;&#x7C7B;&#x548C;&#x5BF9;&#x8C61;&#xFF0C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x6211;&#x4EEC;&#x53BB;&#x64CD;&#x4F5C;&#x5B83;&#x7684;&#x6210;&#x5458;&#xFF0C;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x540C;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x53E6;&#x4E00;&#x79CD;&#x5BF9;&#x8C61;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x8FD9;&#x4E2A;&#x7C7B;&#x5F53;&#x505A;&#x7816;&#x4ECE;&#x800C;&#x53BB;&#x9020;&#x5927;&#x623F;&#x5B50;&#xFF0C;map&#x548C;filter&#x5C31;&#x4F5C;&#x7528;&#x5728;&#x8FD9;&#x7C7B;&#x7ED3;&#x6784;&#x4E0A;&#xFF0C;&#x7406;&#x8BBA;&#x4E0A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x6784;&#x9020;&#x51FA;&#x6240;&#x6709;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x7816;&#x3002;</p>
<h2 id="&#x4E09;-Why&#xFF1F;_rxjava&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;">&#x4E09;.Why&#xFF1F;&#x3000;rxjava&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;</h2><p>&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x7559;&#x7F6E;&#x4EE5;&#x540E;&#x7814;&#x7A76;&#x3002;</p>
<p>&#x53C2;&#x8003;&#x8D44;&#x6599;<br><a href="http://gank.io/post/560e15be2dca930e00da1083" target="_blank" rel="external">&#x7ED9; Android &#x5F00;&#x53D1;&#x8005;&#x7684; RxJava &#x8BE6;&#x89E3;</a> </p>
<p>Github<br><a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="external">rxJava</a><br><a href="https://github.com/ReactiveX/RxAndroid" target="_blank" rel="external">rxAndroid</a></p>
<p>&#x5728;AndroidStudio&#x4E2D;&#x4F7F;&#x7528;lambda&#x8868;&#x8FBE;&#x5F0F;<br><a href="https://github.com/evant/gradle-retrolambda" target="_blank" rel="external">gradle-retrolambda</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 王祖亮
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>